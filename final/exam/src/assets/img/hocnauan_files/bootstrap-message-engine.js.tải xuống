!function(){function e(e){return e&&e.__esModule?e.default:e}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},i={},s={},a=t.parcelRequire8d74;null==a&&((a=function(e){if(e in i)return i[e].exports;if(e in s){var t=s[e];delete s[e];var a={id:e,exports:{}};return i[e]=a,t.call(a.exports,a,a.exports),a.exports}var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(e,t){s[e]=t},t.parcelRequire8d74=a),a.register("lQ6L5",(function(e,t){var i=a("2t0No");function s(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==i&&"env"in i&&(e=void 0),e}(t=e.exports=a("8wSOW")).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var i=this.useColors;if(e[0]=(i?"%c":"")+this.namespace+(i?" %c":" ")+e[0]+(i?"%c ":" ")+"+"+t.humanize(this.diff),!i)return;var s="color: "+this.color;e.splice(1,0,s,"color: inherit");var a=0,r=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(a++,"%c"===e&&(r=a))})),e.splice(r,0,s)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=s,t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(s())})),a.register("2t0No",(function(e,t){var i,s,a=e.exports={};function r(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function o(e){if(i===setTimeout)return setTimeout(e,0);if((i===r||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:r}catch(e){i=r}try{s="function"==typeof clearTimeout?clearTimeout:n}catch(e){s=n}}();var c,l=[],d=!1,u=-1;function g(){d&&c&&(d=!1,c.length?l=c.concat(l):u=-1,l.length&&p())}function p(){if(!d){var e=o(g);d=!0;for(var t=l.length;t;){for(c=l,l=[];++u<t;)c&&c[u].run();u=-1,t=l.length}c=null,d=!1,function(e){if(s===clearTimeout)return clearTimeout(e);if((s===n||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(e);try{s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function m(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];l.push(new h(e,t)),1!==l.length||d||o(p)},h.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=m,a.addListener=m,a.once=m,a.off=m,a.removeListener=m,a.removeAllListeners=m,a.emit=m,a.prependListener=m,a.prependOnceListener=m,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}})),a.register("8wSOW",(function(e,t){var i;function s(e){function s(){if(s.enabled){var e=s,a=+new Date,r=a-(i||a);e.diff=r,e.prev=i,e.curr=a,i=a;for(var n=new Array(arguments.length),o=0;o<n.length;o++)n[o]=arguments[o];n[0]=t.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O");var c=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,(function(i,s){if("%%"===i)return i;c++;var a=t.formatters[s];if("function"==typeof a){var r=n[c];i=a.call(e,r),n.splice(c,1),c--}return i})),t.formatArgs.call(e,n);var l=s.log||t.log||console.log.bind(console);l.apply(e,n)}}return s.namespace=e,s.enabled=t.enabled(e),s.useColors=t.useColors(),s.color=function(e){var i,s=0;for(i in e)s=(s<<5)-s+e.charCodeAt(i),s|=0;return t.colors[Math.abs(s)%t.colors.length]}(e),"function"==typeof t.init&&t.init(s),s}(t=e.exports=s.debug=s.default=s).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){t.save(e),t.names=[],t.skips=[];for(var i=("string"==typeof e?e:"").split(/[\s,]+/),s=i.length,a=0;a<s;a++)i[a]&&("-"===(e=i[a].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){var i,s;for(i=0,s=t.skips.length;i<s;i++)if(t.skips[i].test(e))return!1;for(i=0,s=t.names.length;i<s;i++)if(t.names[i].test(e))return!0;return!1},t.humanize=a("8ncmA"),t.names=[],t.skips=[],t.formatters={}})),a.register("8ncmA",(function(e,t){var i=1e3,s=6e4,a=36e5,r=864e5,n=315576e5;function o(e,t,i){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+i:Math.ceil(e/t)+" "+i+"s"}e.exports=function(e,t){t=t||{};var c,l=typeof e;if("string"===l&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var o=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return o*n;case"days":case"day":case"d":return o*r;case"hours":case"hour":case"hrs":case"hr":case"h":return o*a;case"minutes":case"minute":case"mins":case"min":case"m":return o*s;case"seconds":case"second":case"secs":case"sec":case"s":return o*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}(e);if("number"===l&&!1===isNaN(e))return t.long?o(c=e,r,"day")||o(c,a,"hour")||o(c,s,"minute")||o(c,i,"second")||c+" ms":function(e){return e>=r?Math.round(e/r)+"d":e>=a?Math.round(e/a)+"h":e>=s?Math.round(e/s)+"m":e>=i?Math.round(e/i)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}})),a.register("6rZxb",(function(e,t){
/*!@license
 * UAParser.js v0.7.28
 * Lightweight JavaScript-based User-Agent string parser
 * https://github.com/faisalman/ua-parser-js
 *
 * Copyright Â© 2012-2021 Faisal Salman <f@faisalman.com>
 * Licensed under MIT License
 */
!function(i,s){var a="function",r="undefined",n="object",o="string",c="model",l="name",d="type",u="vendor",g="version",p="architecture",h="console",m="mobile",f="tablet",w="smarttv",y="wearable",b="embedded",v={extend:function(e,t){var i={};for(var s in e)t[s]&&t[s].length%2==0?i[s]=t[s].concat(e[s]):i[s]=e[s];return i},has:function(e,t){return typeof e===o&&-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function(e){return e.toLowerCase()},major:function(e){return typeof e===o?e.replace(/[^\d\.]/g,"").split(".")[0]:s},trim:function(e,t){return e=e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),typeof t===r?e:e.substring(0,255)}},k={rgx:function(e,t){for(var i,r,o,c,l,d,u=0;u<t.length&&!l;){var g=t[u],p=t[u+1];for(i=r=0;i<g.length&&!l;)if(l=g[i++].exec(e))for(o=0;o<p.length;o++)d=l[++r],typeof(c=p[o])===n&&c.length>0?2==c.length?typeof c[1]==a?this[c[0]]=c[1].call(this,d):this[c[0]]=c[1]:3==c.length?typeof c[1]!==a||c[1].exec&&c[1].test?this[c[0]]=d?d.replace(c[1],c[2]):s:this[c[0]]=d?c[1].call(this,d,c[2]):s:4==c.length&&(this[c[0]]=d?c[3].call(this,d.replace(c[1],c[2])):s):this[c]=d||s;u+=2}},str:function(e,t){for(var i in t)if(typeof t[i]===n&&t[i].length>0){for(var a=0;a<t[i].length;a++)if(v.has(t[i][a],e))return"?"===i?s:i}else if(v.has(t[i],e))return"?"===i?s:i;return e}},S={browser:{oldSafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}},oldEdge:{version:{.1:"12.",21:"13.",31:"14.",39:"15.",41:"16.",42:"17.",44:"18."}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},T={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[g,[l,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[g,[l,"Edge"]],[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]{3,6})\b.+version\/([\w\.-]+)/i,/(opera)(?:.+version\/|[\/\s]+)([\w\.]+)/i],[l,g],[/opios[\/\s]+([\w\.]+)/i],[g,[l,"Opera Mini"]],[/\sopr\/([\w\.]+)/i],[g,[l,"Opera"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i,/(avant\s|iemobile|slim)(?:browser)?[\/\s]?([\w\.]*)/i,/(ba?idubrowser)[\/\s]?([\w\.]+)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon)\/([\w\.-]+)/i,/(rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([\w\.]+)/i,/(weibo)__([\d\.]+)/i],[l,g],[/(?:[\s\/]uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[g,[l,"UCBrowser"]],[/(?:windowswechat)?\sqbcore\/([\w\.]+)\b.*(?:windowswechat)?/i],[g,[l,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[g,[l,"WeChat"]],[/konqueror\/([\w\.]+)/i],[g,[l,"Konqueror"]],[/trident.+rv[:\s]([\w\.]{1,9})\b.+like\sgecko/i],[g,[l,"IE"]],[/yabrowser\/([\w\.]+)/i],[g,[l,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[l,/(.+)/,"$1 Secure Browser"],g],[/focus\/([\w\.]+)/i],[g,[l,"Firefox Focus"]],[/opt\/([\w\.]+)/i],[g,[l,"Opera Touch"]],[/coc_coc_browser\/([\w\.]+)/i],[g,[l,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[g,[l,"Dolphin"]],[/coast\/([\w\.]+)/i],[g,[l,"Opera Coast"]],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[g,[l,"MIUI Browser"]],[/fxios\/([\w\.-]+)/i],[g,[l,"Firefox"]],[/(qihu|qhbrowser|qihoobrowser|360browser)/i],[[l,"360 Browser"]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[[l,/(.+)/,"$1 Browser"],g],[/(comodo_dragon)\/([\w\.]+)/i],[[l,/_/g," "],g],[/\s(electron)\/([\w\.]+)\ssafari/i,/(tesla)(?:\sqtcarbrowser|\/(20[12]\d\.[\w\.-]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/\s]?([\w\.]+)/i],[l,g],[/(MetaSr)[\/\s]?([\w\.]+)/i,/(LBBROWSER)/i],[l],[/;fbav\/([\w\.]+);/i],[g,[l,"Facebook"]],[/FBAN\/FBIOS|FB_IAB\/FB4A/i],[[l,"Facebook"]],[/safari\s(line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/\s]([\w\.-]+)/i],[l,g],[/\bgsa\/([\w\.]+)\s.*safari\//i],[g,[l,"GSA"]],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[g,[l,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[l,"Chrome WebView"],g],[/droid.+\sversion\/([\w\.]+)\b.+(?:mobile\ssafari|safari)/i],[g,[l,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[l,g],[/version\/([\w\.]+)\s.*mobile\/\w+\s(safari)/i],[g,[l,"Mobile Safari"]],[/version\/([\w\.]+)\s.*(mobile\s?safari|safari)/i],[g,l],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[l,[g,k.str,S.browser.oldSafari.version]],[/(webkit|khtml)\/([\w\.]+)/i],[l,g],[/(navigator|netscape)\/([\w\.-]+)/i],[[l,"Netscape"],g],[/ile\svr;\srv:([\w\.]+)\).+firefox/i],[g,[l,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(firefox)\/([\w\.]+)\s[\w\s\-]+\/[\w\.]+$/i,/(mozilla)\/([\w\.]+)\s.+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]*)/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[l,g]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[p,"amd64"]],[/(ia32(?=;))/i],[[p,v.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[p,"ia32"]],[/\b(aarch64|armv?8e?l?)\b/i],[[p,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[p,"armhf"]],[/windows\s(ce|mobile);\sppc;/i],[[p,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[p,/ower/,"",v.lowerize]],[/(sun4\w)[;\)]/i],[[p,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?:64|(?=v(?:[1-7]|[5-7]1)l?|;|eabi))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[p,v.lowerize]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[pt]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus\s10)/i],[c,[u,"Samsung"],[d,f]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy\snexus)/i,/\ssamsung[\s-]([\w-]+)/i,/sec-(sgh\w+)/i],[c,[u,"Samsung"],[d,m]],[/\((ip(?:hone|od)[\s\w]*);/i],[c,[u,"Apple"],[d,m]],[/\((ipad);[\w\s\),;-]+apple/i,/applecoremedia\/[\w\.]+\s\((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[c,[u,"Apple"],[d,f]],[/\b((?:agr|ags[23]|bah2?|sht?)-a?[lw]\d{2})/i],[c,[u,"Huawei"],[d,f]],[/d\/huawei([\w\s-]+)[;\)]/i,/\b(nexus\s6p|vog-[at]?l\d\d|ane-[at]?l[x\d]\d|eml-a?l\d\da?|lya-[at]?l\d[\dc]|clt-a?l\d\di?|ele-l\d\d)/i,/\b(\w{2,4}-[atu][ln][01259][019])[;\)\s]/i],[c,[u,"Huawei"],[d,m]],[/\b(poco[\s\w]+)(?:\sbuild|\))/i,/\b;\s(\w+)\sbuild\/hm\1/i,/\b(hm[\s\-_]?note?[\s_]?(?:\d\w)?)\sbuild/i,/\b(redmi[\s\-_]?(?:note|k)?[\w\s_]+)(?:\sbuild|\))/i,/\b(mi[\s\-_]?(?:a\d|one|one[\s_]plus|note lte)?[\s_]?(?:\d?\w?)[\s_]?(?:plus)?)\sbuild/i],[[c,/_/g," "],[u,"Xiaomi"],[d,m]],[/\b(mi[\s\-_]?(?:pad)(?:[\w\s_]+))(?:\sbuild|\))/i],[[c,/_/g," "],[u,"Xiaomi"],[d,f]],[/;\s(\w+)\sbuild.+\soppo/i,/\s(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007)\b/i],[c,[u,"OPPO"],[d,m]],[/\svivo\s(\w+)(?:\sbuild|\))/i,/\s(v[12]\d{3}\w?[at])(?:\sbuild|;)/i],[c,[u,"Vivo"],[d,m]],[/\s(rmx[12]\d{3})(?:\sbuild|;)/i],[c,[u,"Realme"],[d,m]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)\b[\w\s]+build\//i,/\smot(?:orola)?[\s-](\w*)/i,/((?:moto[\s\w\(\)]+|xt\d{3,4}|nexus\s6)(?=\sbuild|\)))/i],[c,[u,"Motorola"],[d,m]],[/\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[c,[u,"Motorola"],[d,f]],[/((?=lg)?[vl]k\-?\d{3})\sbuild|\s3\.[\s\w;-]{10}lg?-([06cv9]{3,4})/i],[c,[u,"LG"],[d,f]],[/(lm-?f100[nv]?|nexus\s[45])/i,/lg[e;\s\/-]+((?!browser|netcast)\w+)/i,/\blg(\-?[\d\w]+)\sbuild/i],[c,[u,"LG"],[d,m]],[/(ideatab[\w\-\s]+)/i,/lenovo\s?(s(?:5000|6000)(?:[\w-]+)|tab(?:[\s\w]+)|yt[\d\w-]{6}|tb[\d\w-]{6})/i],[c,[u,"Lenovo"],[d,f]],[/(?:maemo|nokia).*(n900|lumia\s\d+)/i,/nokia[\s_-]?([\w\.-]*)/i],[[c,/_/g," "],[u,"Nokia"],[d,m]],[/droid.+;\s(pixel\sc)[\s)]/i],[c,[u,"Google"],[d,f]],[/droid.+;\s(pixel[\s\daxl]{0,6})(?:\sbuild|\))/i],[c,[u,"Google"],[d,m]],[/droid.+\s([c-g]\d{4}|so[-l]\w+|xq-a\w[4-7][12])(?=\sbuild\/|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[c,[u,"Sony"],[d,m]],[/sony\stablet\s[ps]\sbuild\//i,/(?:sony)?sgp\w+(?:\sbuild\/|\))/i],[[c,"Xperia Tablet"],[u,"Sony"],[d,f]],[/\s(kb2005|in20[12]5|be20[12][59])\b/i,/\ba000(1)\sbuild/i,/\boneplus\s(a\d{4})[\s)]/i],[c,[u,"OnePlus"],[d,m]],[/(alexa)webm/i,/(kf[a-z]{2}wi)(\sbuild\/|\))/i,/(kf[a-z]+)(\sbuild\/|\)).+silk\//i],[c,[u,"Amazon"],[d,f]],[/(sd|kf)[0349hijorstuw]+(\sbuild\/|\)).+silk\//i],[[c,"Fire Phone"],[u,"Amazon"],[d,m]],[/\((playbook);[\w\s\),;-]+(rim)/i],[c,u,[d,f]],[/((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10;\s(\w+)/i],[c,[u,"BlackBerry"],[d,m]],[/(?:\b|asus_)(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus\s7|padfone|p00[cj])/i],[c,[u,"ASUS"],[d,f]],[/\s(z[es]6[027][01][km][ls]|zenfone\s\d\w?)\b/i],[c,[u,"ASUS"],[d,m]],[/(nexus\s9)/i],[c,[u,"HTC"],[d,f]],[/(htc)[;_\s-]{1,2}([\w\s]+(?=\)|\sbuild)|\w+)/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],[u,[c,/_/g," "],[d,m]],[/droid[x\d\.\s;]+\s([ab][1-7]\-?[0178a]\d\d?)/i],[c,[u,"Acer"],[d,f]],[/droid.+;\s(m[1-5]\snote)\sbuild/i,/\bmz-([\w-]{2,})/i],[c,[u,"Meizu"],[d,m]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i,/(microsoft);\s(lumia[\s\w]+)/i,/(lenovo)[_\s-]?([\w-]+)/i,/linux;.+(jolla);/i,/droid.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[u,c,[d,m]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i,/[;\/]\s?(le[\s\-]+pan)[\s\-]+(\w{1,9})\sbuild/i,/[;\/]\s?(trinity)[\-\s]*(t\d{3})\sbuild/i,/\b(gigaset)[\s\-]+(q\w{1,9})\sbuild/i,/\b(vodafone)\s([\w\s]+)(?:\)|\sbuild)/i],[u,c,[d,f]],[/\s(surface\sduo)\s/i],[c,[u,"Microsoft"],[d,f]],[/droid\s[\d\.]+;\s(fp\du?)\sbuild/i],[c,[u,"Fairphone"],[d,m]],[/\s(u304aa)\sbuild/i],[c,[u,"AT&T"],[d,m]],[/sie-(\w*)/i],[c,[u,"Siemens"],[d,m]],[/[;\/]\s?(rct\w+)\sbuild/i],[c,[u,"RCA"],[d,f]],[/[;\/\s](venue[\d\s]{2,7})\sbuild/i],[c,[u,"Dell"],[d,f]],[/[;\/]\s?(q(?:mv|ta)\w+)\sbuild/i],[c,[u,"Verizon"],[d,f]],[/[;\/]\s(?:barnes[&\s]+noble\s|bn[rt])([\w\s\+]*)\sbuild/i],[c,[u,"Barnes & Noble"],[d,f]],[/[;\/]\s(tm\d{3}\w+)\sbuild/i],[c,[u,"NuVision"],[d,f]],[/;\s(k88)\sbuild/i],[c,[u,"ZTE"],[d,f]],[/;\s(nx\d{3}j)\sbuild/i],[c,[u,"ZTE"],[d,m]],[/[;\/]\s?(gen\d{3})\sbuild.*49h/i],[c,[u,"Swiss"],[d,m]],[/[;\/]\s?(zur\d{3})\sbuild/i],[c,[u,"Swiss"],[d,f]],[/[;\/]\s?((zeki)?tb.*\b)\sbuild/i],[c,[u,"Zeki"],[d,f]],[/[;\/]\s([yr]\d{2})\sbuild/i,/[;\/]\s(dragon[\-\s]+touch\s|dt)(\w{5})\sbuild/i],[[u,"Dragon Touch"],c,[d,f]],[/[;\/]\s?(ns-?\w{0,9})\sbuild/i],[c,[u,"Insignia"],[d,f]],[/[;\/]\s?((nxa|Next)-?\w{0,9})\sbuild/i],[c,[u,"NextBook"],[d,f]],[/[;\/]\s?(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05]))\sbuild/i],[[u,"Voice"],c,[d,m]],[/[;\/]\s?(lvtel\-)?(v1[12])\sbuild/i],[[u,"LvTel"],c,[d,m]],[/;\s(ph-1)\s/i],[c,[u,"Essential"],[d,m]],[/[;\/]\s?(v(100md|700na|7011|917g).*\b)\sbuild/i],[c,[u,"Envizen"],[d,f]],[/[;\/]\s?(trio[\s\w\-\.]+)\sbuild/i],[c,[u,"MachSpeed"],[d,f]],[/[;\/]\s?tu_(1491)\sbuild/i],[c,[u,"Rotor"],[d,f]],[/(shield[\w\s]+)\sbuild/i],[c,[u,"Nvidia"],[d,f]],[/(sprint)\s(\w+)/i],[u,c,[d,m]],[/(kin\.[onetw]{3})/i],[[c,/\./g," "],[u,"Microsoft"],[d,m]],[/droid\s[\d\.]+;\s(cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[c,[u,"Zebra"],[d,f]],[/droid\s[\d\.]+;\s(ec30|ps20|tc[2-8]\d[kx])\)/i],[c,[u,"Zebra"],[d,m]],[/\s(ouya)\s/i,/(nintendo)\s([wids3utch]+)/i],[u,c,[d,h]],[/droid.+;\s(shield)\sbuild/i],[c,[u,"Nvidia"],[d,h]],[/(playstation\s[345portablevi]+)/i],[c,[u,"Sony"],[d,h]],[/[\s\(;](xbox(?:\sone)?(?!;\sxbox))[\s\);]/i],[c,[u,"Microsoft"],[d,h]],[/smart-tv.+(samsung)/i],[u,[d,w]],[/hbbtv.+maple;(\d+)/i],[[c,/^/,"SmartTV"],[u,"Samsung"],[d,w]],[/(?:linux;\snetcast.+smarttv|lg\snetcast\.tv-201\d)/i],[[u,"LG"],[d,w]],[/(apple)\s?tv/i],[u,[c,"Apple TV"],[d,w]],[/crkey/i],[[c,"Chromecast"],[u,"Google"],[d,w]],[/droid.+aft([\w])(\sbuild\/|\))/i],[c,[u,"Amazon"],[d,w]],[/\(dtv[\);].+(aquos)/i],[c,[u,"Sharp"],[d,w]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[u,v.trim],[c,v.trim],[d,w]],[/[\s\/\(](android\s|smart[-\s]?|opera\s)tv[;\)\s]/i],[[d,w]],[/((pebble))app\/[\d\.]+\s/i],[u,c,[d,y]],[/droid.+;\s(glass)\s\d/i],[c,[u,"Google"],[d,y]],[/droid\s[\d\.]+;\s(wt63?0{2,3})\)/i],[c,[u,"Zebra"],[d,y]],[/(tesla)(?:\sqtcarbrowser|\/20[12]\d\.[\w\.-]+)/i],[u,[d,b]],[/droid .+?; ([^;]+?)(?: build|\) applewebkit).+? mobile safari/i],[c,[d,m]],[/droid .+?;\s([^;]+?)(?: build|\) applewebkit).+?(?! mobile) safari/i],[c,[d,f]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[d,v.lowerize]],[/(android[\w\.\s\-]{0,9});.+build/i],[c,[u,"Generic"]],[/(phone)/i],[[d,m]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[g,[l,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[g,[l,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[l,g],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[g,l]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[l,g],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)(?!.+xbox)/i],[l,[g,k.str,S.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[l,"Windows"],[g,k.str,S.os.windows.version]],[/ip[honead]{2,4}\b(?:.*os\s([\w]+)\slike\smac|;\sopera)/i,/cfnetwork\/.+darwin/i],[[g,/_/g,"."],[l,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)(?!.+haiku)/i],[[l,"Mac OS"],[g,/_/g,"."]],[/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|sailfish|contiki)[\/\s-]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/\s]([\w\.]+)/i,/\((series40);/i],[l,g],[/\(bb(10);/i],[g,[l,"BlackBerry"]],[/(?:symbian\s?os|symbos|s60(?=;)|series60)[\/\s-]?([\w\.]*)/i],[g,[l,"Symbian"]],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[l,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[g,[l,"webOS"]],[/crkey\/([\d\.]+)/i],[g,[l,"Chromecast"]],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[l,"Chromium OS"],g],[/(nintendo|playstation)\s([wids345portablevuch]+)/i,/(xbox);\s+xbox\s([^\);]+)/i,/(mint)[\/\s\(\)]?(\w*)/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?=\slinux)|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus|raspbian)(?:\sgnu\/linux)?(?:\slinux)?[\/\s-]?(?!chrom|package)([\w\.-]*)/i,/(hurd|linux)\s?([\w\.]*)/i,/(gnu)\s?([\w\.]*)/i,/\s([frentopc-]{0,4}bsd|dragonfly)\s?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku)\s(\w+)/i],[l,g],[/(sunos)\s?([\w\.\d]*)/i],[[l,"Solaris"],g],[/((?:open)?solaris)[\/\s-]?([\w\.]*)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms|fuchsia)/i,/(unix)\s?([\w\.]*)/i],[l,g]]},C=function(e,t){if("object"==typeof e&&(t=e,e=s),!(this instanceof C))return new C(e,t).getResult();var a=e||(void 0!==i&&i.navigator&&i.navigator.userAgent?i.navigator.userAgent:""),r=t?v.extend(T,t):T;return this.getBrowser=function(){var e={name:s,version:s};return k.rgx.call(e,a,r.browser),e.major=v.major(e.version),e},this.getCPU=function(){var e={architecture:s};return k.rgx.call(e,a,r.cpu),e},this.getDevice=function(){var e={vendor:s,model:s,type:s};return k.rgx.call(e,a,r.device),e},this.getEngine=function(){var e={name:s,version:s};return k.rgx.call(e,a,r.engine),e},this.getOS=function(){var e={name:s,version:s};return k.rgx.call(e,a,r.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return a},this.setUA=function(e){return a=typeof e===o&&e.length>255?v.trim(e,255):e,this},this.setUA(a),this};C.VERSION="0.7.28",C.BROWSER={NAME:l,MAJOR:"major",VERSION:g},C.CPU={ARCHITECTURE:p},C.DEVICE={MODEL:c,VENDOR:u,TYPE:d,CONSOLE:h,MOBILE:m,SMARTTV:w,TABLET:f,WEARABLE:y,EMBEDDED:b},C.ENGINE={NAME:l,VERSION:g},C.OS={NAME:l,VERSION:g},typeof t!==r?(e.exports&&(t=e.exports=C),t.UAParser=C):"function"==typeof define&&define.amd?define((function(){return C})):void 0!==i&&(i.UAParser=C);var x=void 0!==i&&(i.jQuery||i.Zepto);if(x&&!x.ua){var D=new C;x.ua=D.getResult(),x.ua.get=function(){return D.getUA()},x.ua.set=function(e){D.setUA(e);var t=D.getResult();for(var i in t)x.ua[i]=t[i]}}}("object"==typeof window?window:this)}));var r=a("lQ6L5");class n{addMessages(){}addHandledMessageTypes(){}addEvent(){}flush(){}sendPricingApiResult(e){}}const o=e=>JSON.parse(JSON.stringify(e)),c=e=>{if(Array.isArray(e))return e.join(", ");try{return c(Object.entries(e).map((e=>e.join(": "))))}catch(e){return""}};class l{addMessages(e){e.forEach((e=>this.ensure(e)))}ensure(e){return this.store[e]||(this.store[e]=[]),this.store[e]}sendPricingApiResult(e){const t=o(e);window.postMessage({type:"triptease.message-engine.price-check",payload:t})}constructor(e){this.addHandledMessageTypes=(e,t)=>{this.handledMessageTypes.push(...e),this.environment=t},this.addEvent=(e,t,i)=>{t.forEach((t=>{this.ensure(t).push({event:e,additionalInformation:i&&c(i)})}))},this.flush=()=>{const e={messages:o(this.store),handledTypes:{types:this.handledMessageTypes,environment:this.environment}};this.store={},window.postMessage({type:"triptease.message-engine.diagnostics",payload:e},"*")},this.store={},this.handledMessageTypes=[],this.environment={},this.log=e}}const d=()=>{try{return localStorage.debug?.startsWith("message-engine")||!1}catch(e){return!1}};let u;function g(t="message-engine"){return u||(u=function(e,t){return{diagnostics:d()?new l(e(`${t}:log`)):new n,log:e(`${t}:log`),info:e(`${t}:info`),warn:e(`${t}:warn`),error:e(`${t}:error`)}}(e(r),t)),u}let p,h,m,f,w,y,b,v,k,S,T,C,x,D,_,I,P,A,R,E,N,O,M,U,W,$;!function(e){e.countdown="countdown",e.crisis="crisis",e.emailCapture="email-capture",e.fullScreen="full-screen",e.inPage="in-page",e.notifications="notifications",e.nudge="nudge",e.priceCheck="price-check",e.saveTheSearch="save-the-search",e.undercut="undercut",e.inline="inline",e.previewAssist="preview-assist"}(p||(p={})),function(e){e.bookers="bookers",e.searchers="searchers",e.location="location"}(h||(h={})),function(e){e.messageEngineWidgetData="tt_message_engine_widget_data",e.messageEngineShowWidget="tt_message_engine_show_widget",e.platformUpdate="tt_platform_update",e.saveTheSearchReady="tt_save_the_search_ready",e.emailCaptureReady="tt_email_capture_ready",e.nudgeReady="tt_nudge_ready",e.countdownReady="tt_countdown_ready",e.inPageReady="tt_in_page_ready",e.inlineReady="tt_inline_ready",e.previewAssistReady="tt_preview_assist_ready",e.undercutReady="tt_undercut_ready",e.priceCheckReady="tt_price_check_ready",e.notificationsReady="tt_notifications_ready",e.fullScreenReady="tt_full_screen_ready",e.crisisReady="tt_crisis_ready",e.forceFullScreenVisible="tt_force_full_screen_visible",e.messageReveal="tt_message_reveal",e.messageDismiss="tt_message_dismiss",e.trackEventZappy="tt_track_event_zappy",e.trackEvent="tt_track_event",e.widgetDimensionsChange="tt_widget_dimensions_change",e.localStorageRequestItem="tt_local_storage_request_item",e.localStorageSetItem="tt_local_storage_set_item",e.localStorageRemoveItem="tt_local_storage_remove_item",e.localStorageItem="tt_local_storage_item",e.localStorageClear="tt_local_storage_clear",e.webShareAPIStatus="tt_web_share_api_status",e.optOutOfExperiments="tt_opt_out_of_experiments",e.captureGuestEmail="tt_capture_guest_email",e.shareSearchViaEmail="tt_share_search_via_email",e.emailRequestFinish="tt_email_request_finish",e.incomingPricingData="tt_incoming_pricing_data"}(m||(m={})),function(e){e.messageRevealsKey="tt_message_engine_message_reveals",e.messageDismissesKey="tt_message_engine_message_dismisses",e.latestSearchKey="tt_message_engine_latest_search",e.latestVisitInfoKey="tt_message_engine_latest_visit_info",e.optOutOfExperiments="tt_message_engine_opt_out_of_experiments"}(f||(f={})),function(e){e.abandonment="abandonment",e.opened="opened",e.closed="closed",e.notifications="notifications",e.notificationsOpen="open",e.notificationsClose="close",e.notificationsCloseButtonClick="close_button_click",e.notificationsTeaserClick="teaser_click",e.notificationsMouseEnter="mouse_enter",e.notificationsSearchersTooLow="searchers_too_low",e.messageEngine="messageEngine",e.load="load",e.messageAvailable="messageAvailable",e.placementSelector="placementSelector",e.propensityToConvert="propensityToConvert",e.priceCheck="spaceInvaders",e.priceCheckLoad="Load",e.priceCheckReveal="Reveal",e.priceCheckComplete="Widget Complete",e.priceCheckClick="Widget Clicked",e.priceCheckHover="Widget Hovered",e.priceCheckLayout="UpliftPriceCheck"}(w||(w={})),function(e){e.top="top",e.left="left",e.full="full"}(y||(y={})),function(e){e.self="_top",e.newTabOrWindow="_blank"}(b||(b={})),function(e){e.FullImage="full-image",e.PriceCheck="price-check",e.Text="text"}(v||(v={})),function(e){e.Button="button",e.CopyOnClick="copy-on-click",e.Share="share",e.None="none"}(k||(k={})),function(e){e.None="none",e.FirstAndLastName="first-and-last-name",e.FullName="full-name"}(S||(S={})),function(e){e.Amiko="Amiko",e.BarlowCondensed="Barlow Condensed",e.Bitter="Bitter",e.Cabin="Cabin",e.Cinzel="Cinzel",e.CormorantGaramond="Cormorant Garamond",e.CrimsonText="Crimson Text",e.EBGaramond="EB Garamond",e.Glegoo="Glegoo",e.Hind="Hind",e.Lato="Lato",e.Lora="Lora",e.Montserrat="Montserrat",e.MontserratAlternates="Montserrat Alternates",e.Muli="Muli",e.NoticiaText="Noticia Text",e.OpenSans="Open Sans",e.Oswald="Oswald",e.PTSans="PT Sans",e.PetitFormalScript="Petit Formal Script",e.PlayfairDisplay="Playfair Display",e.Poppins="Poppins",e.Quicksand="Quicksand",e.Raleway="Raleway",e.Roboto="Roboto",e.Signika="Signika",e.SourceSerifPro="Source Serif Pro",e.Ubuntu="Ubuntu",e.Volkhov="Volkhov",e.WorkSans="Work Sans"}(T||(T={})),function(e){e.rounded="rounded",e.square="square"}(C||(C={})),function(e){e.rounded="rounded",e.pill="pill",e.square="square"}(x||(x={})),function(e){e.UNDERCUT="undercut",e.PARITY="in_parity",e.CHEAPER_DIRECT="cheaper_direct"}(D||(D={})),function(e){e.inXDays="inXDays",e.afterXDays="afterXDays",e.compoundBetween="compoundBetween",e.compoundDurations="compoundDurations",e.daysOfWeek="daysOfWeek",e.referrers="referrers",e.tripteaseChannels="tripteaseChannels",e.newVsReturning="newVsReturning",e.urlInclusions="urlInclusions",e.urlExclusions="urlExclusions",e.locations="locations",e.likelihoodToConvert="likelihoodToConvert",e.partySize="partySize",e.deviceType="deviceType",e.webTraffic="webTraffic",e.metaParityStatus="metaParityStatus",e.pageTypes="pageTypes",e.userTypes="userTypes"}(_||(_={})),function(e){e.mobile="mobile",e.desktop="desktop"}(I||(I={})),function(e){e.Unknown="Unknown",e.RoomsAndRates="RoomsAndRates",e.Confirmation="Confirmation"}(P||(P={})),function(e){e.Member="member",e.Unknown="unknown"}(A||(A={})),function(e){e.COUNTRY="Country",e.REGION="Region",e.CITY="City"}(R||(R={})),function(e){e.individual="individual",e.couple="couple",e.family="family",e.group="group"}(E||(E={})),function(e){e.High="high",e.Low="low",e.Undetermined="undetermined"}(N||(N={})),function(e){e.bestDirect="bestDirect",e.allUndercut="allUndercut",e.unknown="unknown"}(O||(O={})),function(e){e.load="load",e.events="events"}(M||(M={})),function(e){e.abandonment="abandonment",e.messageEngine="messageEngine"}(U||(U={})),function(e){e.ExperimentsUserAssignment="triptease.messages.experiments.user_assignment",e.Zappy="triptease.messages.zappy"}(W||(W={})),function(e){e.Config="triptease.config",e.Navigation="triptease.navigation"}($||($={}));const L=["clientName","pageType","pageUrl","userAgent","userId","sessionId","pageVisitId"],V=(e,t,i)=>{if(e===t)return!0;if(K(e)&&K(t))return e===t;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let s in e)if(s!==i){if(!(s in t))return!1;if(!V(e[s],t[s]))return!1}return!0},K=e=>e!==Object(e);var z,B,j={},q="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(q){var F=new Uint8Array(16);j=function(){return q(F),F}}else{var H=new Array(16);j=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),H[t]=e>>>((3&t)<<3)&255;return H}}for(var G,X,J={},Z=[],Y=0;Y<256;++Y)Z[Y]=(Y+256).toString(16).substr(1);J=function(e,t){var i=t||0,s=Z;return[s[e[i++]],s[e[i++]],s[e[i++]],s[e[i++]],"-",s[e[i++]],s[e[i++]],"-",s[e[i++]],s[e[i++]],"-",s[e[i++]],s[e[i++]],"-",s[e[i++]],s[e[i++]],s[e[i++]],s[e[i++]],s[e[i++]],s[e[i++]]].join("")};var Q=0,ee=0;B=function(e,t,i){var s=t&&i||0,a=t||[],r=(e=e||{}).node||G,n=void 0!==e.clockseq?e.clockseq:X;if(null==r||null==n){var o=j();null==r&&(r=G=[1|o[0],o[1],o[2],o[3],o[4],o[5]]),null==n&&(n=X=16383&(o[6]<<8|o[7]))}var c=void 0!==e.msecs?e.msecs:(new Date).getTime(),l=void 0!==e.nsecs?e.nsecs:ee+1,d=c-Q+(l-ee)/1e4;if(d<0&&void 0===e.clockseq&&(n=n+1&16383),(d<0||c>Q)&&void 0===e.nsecs&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Q=c,ee=l,X=n;var u=(1e4*(268435455&(c+=122192928e5))+l)%4294967296;a[s++]=u>>>24&255,a[s++]=u>>>16&255,a[s++]=u>>>8&255,a[s++]=255&u;var g=c/4294967296*1e4&268435455;a[s++]=g>>>8&255,a[s++]=255&g,a[s++]=g>>>24&15|16,a[s++]=g>>>16&255,a[s++]=n>>>8|128,a[s++]=255&n;for(var p=0;p<6;++p)a[s+p]=r[p];return t||J(a)};var te;var ie=te=function(e,t,i){var s=t&&i||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||j)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var r=0;r<16;++r)t[s+r]=a[r];return t||J(a)};ie.v1=B,ie.v4=te,z=ie;var se={environment:"production",saveTheSearchSrc:"https://static.triptease.io/message-porter/dist/savethesearch.html",nudgeSrc:"https://static.triptease.io/message-porter/dist/nudge.html",countdownSrc:"https://static.triptease.io/message-porter/dist/countdown.html",undercutSrc:"https://static.triptease.io/message-porter/dist/undercut.html",priceCheckSrc:"https://static.triptease.io/message-porter/dist/pricecheck.html",notificationsSrc:"https://static.triptease.io/message-porter/dist/notifications.html",fullScreenSrc:"https://static.triptease.io/message-porter/dist/fullscreen.html",crisisSrc:"https://static.triptease.io/message-porter/dist/crisis.html",inlineSrc:"https://static.triptease.io/message-porter/dist/inline.html",inPageSrc:"https://static.triptease.io/message-porter/dist/inpage.html",emailCaptureSrc:"https://static.triptease.io/message-porter/dist/emailcapture.html",previewAssistSrc:"https://static.triptease.io/message-porter/dist/previewassist.html",storageIframeSrc:"https://static.triptease.io/message-porter/dist/storageIframe.html",campaignServiceUrl:"https://messages.guest-experience.triptease.io",priceCheckApiUrl:"https://price-check.pf.triptease.io",zappyUrl:"https://api.triptease.io/zappy"};async function ae(e){const t=await fetch(e.url,{method:e.method||"GET",headers:e.headers,body:e.body});return{status:t.status,headers:ne(t.headers),body:await t.text()}}function re({method:e="POST",url:t,body:i}){const s=JSON.stringify(i);if(void 0!==navigator.sendBeacon&&"POST"===e)navigator.sendBeacon(t,s);else if("undefined"!=typeof fetch)return fetch(t,{method:e,body:s})}function ne(e){let t={};for(let i of e.entries()){const[e,s]=i;t[e]=s}return t}class oe{track(t){const i={eventName:t.eventName,eventAppName:t.eventAppName};return re({url:`${se.zappyUrl}/event?${ce(i)}`,body:{eventType:"AppEvent",value:{...t,eventId:e(z).v4(),createdTime:new Date,userAgent:this.externalState.userAgent,userId:this.externalState.userId,sessionId:this.externalState.sessionId,pageVisitId:this.externalState.pageVisitId,clientName:this.externalState.clientName,version:this.initialInternalState.version}}})}constructor(e,t){this.externalState=e,this.initialInternalState=t}}const ce=e=>Object.keys(e).map((t=>`${t}=${encodeURIComponent(e[t])}`)).join("&"),le=({eventName:t,eventAppName:i,payload:s})=>({eventType:"AppEvent",value:{...s,eventName:t,eventAppName:i,eventId:e(z).v4(),createdTime:new Date,userAgent:navigator.userAgent,campaignType:s.messageType,campaignId:s.messageId}}),de=({eventName:e,eventAppName:t,payload:i})=>re({url:`${se.zappyUrl}/event?${ce({eventName:e,eventAppName:t})}`,body:le({eventName:e,eventAppName:t,payload:i})});function ue(e){return{adults:e.adults,children:e.children,checkin:e.checkin,checkout:e.checkout,rooms:e.rooms}}function ge(e){return{...ue(e),rateDetails:e.rateDetails.map((e=>({price:e.price,currency:e.currency.toUpperCase(),rateName:e.rateName,rateCode:e.rateCode,roomName:e.roomName,roomCode:e.roomCode,basePrice:e.basePrice,rooms:e.rooms,tags:e.tags}))),total:e.total,promoCodes:e.promoCodes,allowedRates:e.allowedRates,excludedRates:e.excludedRates,allowedPromoCodes:e.allowedPromoCodes,ratesModified:e.ratesModified}}function pe(e){return e.type===P.RoomsAndRates&&Array.isArray(e.rateDetails)}const he=e=>{const t=e.payload,i=function(e,t){return{language:e.language||t.page.locale||t.locale,referrer:t.page.referrer,pageUrl:t.page.url,pageTitle:t.page.title,userAgent:t.userAgent}}(t,e.context),s=function(e){return{userId:e.userId,sessionId:e.sessionId,pageVisitId:e.pageVisitId}}(e),a={...i,...s,appName:e.context.app?.name,applications:e.applications,clientKey:t.clientKey,clientName:t.clientName,pageType:t.type||P.Unknown,userTypes:t.userTypes||[],apiKey:t.apiKey,hotelName:t.hotelName,priceCheckData:pe(t)?ge(t):void 0,isPreview:i.pageUrl.indexOf("preview")>-1};if(!pe(t))return a;if(r=t.rateDetails,Array.isArray(r)&&r.some((e=>!!e.apiKey))){const e=t.rateDetails.sort(((e,t)=>e.price-t.price))[0];return{...a,apiKey:e.apiKey,hotelName:e.hotelName,search:ue(t),priceCheckData:ge({...t,rateDetails:[e]})}}var r;return{...a,search:ue(t),priceCheckData:ge(t)}};class me{async webShareAPIAvailable(){try{const e=await this.sendToLocalStorage(m.webShareAPIStatus);return"boolean"==typeof e&&e}catch(e){return!1}}async isAvailable(){const e="test-key",t="test-value";try{await this.set(e,t);const i=await this.get(e);return await this.remove(e),i===t}catch(e){return!1}}async set(e,t){const i=m.localStorageSetItem;await this.sendToLocalStorage(i,{key:e,value:t})}async get(e){const t=m.localStorageRequestItem,i=await this.sendToLocalStorage(t,{key:e});return i?String(i):void 0}async remove(e){const t=m.localStorageRemoveItem;await this.sendToLocalStorage(t,{key:e})}async clearAll(){const e=m.localStorageClear;await this.sendToLocalStorage(e)}isLocalStorageMessageResponse(e,t,i){return!(!this.storageIframe||this.storageIframe.contentWindow!==e.source||!e.data||e.data.type!==t||void 0!==i&&e.data.payload.key!==i)}async sendToLocalStorage(e,t){if(this.storageIframe&&this.storageIframe.contentWindow)return this.storageIframe.contentWindow.postMessage({type:e,payload:t},"*"),new Promise((i=>{const s=a=>{this.isLocalStorageMessageResponse(a,e,t&&t.key)&&(this._window.removeEventListener("message",s),i(a.data.payload&&a.data.payload.value))};this._window.addEventListener("message",s)}))}constructor(e,t){this.storageIframe=e,this._window=t,this.storageIframe=e,this._window=t}}function fe(...e){const t={...e[0]};let i=0;for(;i<e.length;){const s=e[i++];s&&ye(t,s)}return t}function we(...e){return fe(...e.reverse())}function ye(e,t){for(const i in t)if(t.hasOwnProperty(i)&&"__proto__"!==i){const s=e[i],a=t[i];null==s?e[i]=a:be(s)&&be(a)?e[i]=fe(s,a):Array.isArray(a)&&(e[i]=a.map(((e,t)=>fe(s[t],a[t],e))))}}function be(e){return!("object"!=typeof e||null==e||e instanceof Date||Array.isArray(e))}function ve(e,t,i){return i===p.notifications?`${t}-${e}`:`${i}-${t}`}async function ke(e,t){try{if(await e.isAvailable()){const i=await e.get(t);return i&&JSON.parse(i)||{}}return{}}catch(e){return{}}}class Se{async getMessageDismisses(){return await ke(this.localStorage,f.messageDismissesKey)}async getMessageReveals(){return await ke(this.localStorage,f.messageRevealsKey)}async updateMessageDismisses(e,t){const i=await this.getMessageDismisses(),s=ve(this.apiKey,e,t);await this.localStorage.set(f.messageDismissesKey,JSON.stringify(we(i,{[s]:Date.now()})))}async updateMessageReveals(e,t){const i=await this.getMessageReveals(),s=ve(this.apiKey,e,t);await this.localStorage.set(f.messageRevealsKey,JSON.stringify(we(i,{[s]:Date.now()})))}constructor(e,t){this.localStorage=e,this.apiKey=t}}var Te=async function({apiKey:e,config:t=se,logger:i,language:s}){const a=s?`language=${s}`:"",r=await ae({url:`${t.campaignServiceUrl}/${e}/messages${a?`?${a}`:""}`});if(r.status>=200&&r.status<300){const e=r.headers["x-country-code"],t=r.headers["x-region-code"],s=r.headers["x-city"],a=JSON.parse(r.body),n={countryCode:e,regionCode:t?`${e}-${t}`:null,city:t&&s?`${e}-${t}-${s}`:null,messages:a.campaigns,notifications:a.notifications,...a};return i.info("Loaded messages:",n),n}return{messages:[],notifications:{}}};function Ce(e){return e.toISOString().split("T")[0]}function xe(e){return e.getFullYear().toString()}function De(e){return Ie(e.getMonth()+1)}function _e(e){return Ie(e.getDate())}function Ie(e){return`${e}`.padStart(2,"0")}function Pe(e,t){return(t.getTime()-e.getTime())/864e5}function Ae(e){return Math.ceil(Pe(new Date,e))}function Re(e,t){return e-t>18e5}function Ee(e,t){return!!e&&(e.isReturningVisitor||Re(t,e.lastSeen))}function Ne(e,t){return e?Re(t,e.lastSeen)?1:++e.pageViews:1}function Oe(e){const{adults:t=0,children:i=0,checkin:s,checkout:a}=e;return[t,i,Ce(s),Ce(a)].join(":")}function Me(e,t,i){return i?{...e&&e.priceQueries,[Oe(i)]:t}:e&&e.priceQueries}function Ue(e,t){if(t)return Object.entries(t).reduce(((t,[i,s])=>(function(e,t){return e-t>288e5}(e,s)||(t[i]=s),t)),{})}var We=async function({apiKey:e,localStorage:t,currentTimestamp:i,search:s}){const a=await t.get(f.latestVisitInfoKey),r=a?JSON.parse(a):{},n=r&&r[e],o={isReturningVisitor:Ee(n,i),firstSeen:n&&n.firstSeen||i,lastSeen:i,pageViews:Ne(n,i),priceQueries:Ue(i,Me(n,i,s))};return await t.set(f.latestVisitInfoKey,JSON.stringify({...r,[e]:o})),o};var $e=async(e,t,i)=>{if(i)return e.set(f.latestSearchKey,JSON.stringify({[t]:i})),i;const s=(await ke(e,f.latestSearchKey))[t];return s?{checkout:new Date(s.checkout),checkin:new Date(s.checkin),adults:Number(s.adults),children:Number(s.children)}:null},Le=a("6rZxb");const Ve=(e,t,i)=>t.map(((t,s)=>e(t,i[s])));var Ke=(e,t)=>Ve(((e,t)=>e*t),e,t).reduce(((e,t)=>e+t),0);var ze=({searchCount:e,browserName:t})=>{const i=Math.sqrt(4.51519294),s=Ke([.43647949,.56805652],["Chrome"===t?1:0,(e-2.49051756)/i])+-.3574456061541282,a=1/(1+Math.exp(-s));return Math.floor(100*a)/100};var Be=class{track(e,t){de({eventName:w.propensityToConvert,eventAppName:w.messageEngine,payload:{apiKey:e.key,userId:t.userId,sessionId:t.sessionId,pageVisitId:t.pageVisitId,clientName:t.clientName,ptcVersion:this.version,bucket:this.likelihoodBucket,probabilityScore:this.probabilityScore}})}constructor(e,t){this.version=2;const i=Object.keys(e.latestVisitInfo.priceQueries||{}).length;if(i<=1)this.likelihoodBucket=N.Undetermined;else{const e=new Le.UAParser(t.userAgent);this.probabilityScore=ze({searchCount:i,browserName:e.getBrowser().name}),this.likelihoodBucket=this.probabilityScore>=.6?N.High:N.Low}this.track(e,t)}};function je(e){const t=qe(e);return-1!==t.indexOf("tt_meta=google")||-1!==t.indexOf("tt_meta=gha")}const qe=e=>e?e.toLowerCase().replace(/\s/g,"").replace(/https?:\/\//,"").replace(/www\./,"").replace(/\/$/,""):"",Fe={[_.compoundBetween]:(e,t,i,s)=>{if(e.criteria.checkInDates&&e.criteria.checkInDates.compoundBetween&&t.latestSearch){const i=t.latestSearch.checkin.toISOString();return e.criteria.checkInDates.compoundBetween.some((e=>i>=e.start&&i<=e.end))}return!0},[_.inXDays]:(e,t,i,s)=>{if(e.criteria.checkInDates&&e.criteria.checkInDates.inXDays&&t.latestSearch){const i=Ae(t.latestSearch.checkin);return i>=0&&i<=parseInt(e.criteria.checkInDates.inXDays,10)}return!0},[_.afterXDays]:(e,t,i,s)=>{if(e.criteria.checkInDates&&e.criteria.checkInDates.afterXDays&&t.latestSearch){const i=Ae(t.latestSearch.checkin),s=e.criteria.checkInDates.afterXDays;return s.end?i>=parseInt(s.start,10)&&i<=parseInt(s.end,10):i>=parseInt(s.start,10)}return!0},[_.compoundDurations]:(e,t,i,s)=>{if(e.criteria.checkInDates&&e.criteria.checkInDates.compoundDurations&&t.latestSearch){const{checkin:i,checkout:s}=t.latestSearch,a=function(e,t){return Pe(new Date(e),new Date(t))}(i,s),r=e.criteria.checkInDates.compoundDurations,n=e.criteria.checkInDates.compoundDurations.map((e=>parseInt(e,10))).filter((e=>!!e)),o=n[n.length-1];return">"===r[r.length-1]&&o<=a||-1!==n.indexOf(a)}return!0},[_.daysOfWeek]:(e,t,i,s)=>{if(e.criteria.checkInDates&&e.criteria.checkInDates.daysOfWeek&&t.latestSearch){const i=t.latestSearch.checkin.getUTCDay();return e.criteria.checkInDates.daysOfWeek.indexOf(i)>-1}return!0},[_.referrers]:(e,t,i,s)=>!e.criteria.referrers||e.criteria.referrers.some((e=>qe(i.referrer).indexOf(qe(e))>-1)),[_.tripteaseChannels]:(e,t,i,s)=>!e.criteria.tripteaseChannels||e.criteria.tripteaseChannels.some((e=>qe(i.pageUrl).indexOf(qe(e))>-1)),[_.metaParityStatus]:(e,t,i,s)=>!e.criteria.metaParityStatus||je(i.pageUrl),[_.newVsReturning]:(e,t,i,s)=>{if(e.criteria.newVsReturning){return"returning"===e.criteria.newVsReturning===t.latestVisitInfo.isReturningVisitor}return!0},[_.urlInclusions]:(e,t,i,s)=>!e.criteria.urlInclusions||e.criteria.urlInclusions.some((({matcherType:e,value:t})=>"equals"===e?qe(i.pageUrl)===qe(t):qe(i.pageUrl).indexOf(qe(t))>-1)),[_.urlExclusions]:(e,t,i,s)=>!e.criteria.urlExclusions||e.criteria.urlExclusions.every((({matcherType:e,value:t})=>"equals"===e?qe(i.pageUrl)!==qe(t):-1===qe(i.pageUrl).indexOf(qe(t)))),[_.locations]:(e,t)=>((e,t)=>{if(e.criteria.locations){if(t.city&&e.criteria.locations.filter((e=>e.exclude&&e.code===t.city)).length)return!1;if(t.regionCode){const i=!e.criteria.locations.some((e=>e.code===t.city));if(e.criteria.locations.filter((e=>e.exclude&&e.code===t.regionCode&&i)).length)return!1}if(t.countryCode){const i=!e.criteria.locations.some((e=>e.code===t.regionCode));if(e.criteria.locations.filter((e=>e.exclude&&e.code===t.countryCode&&i)).length)return!1}return!e.criteria.locations.filter((e=>!e.exclude)).length||e.criteria.locations.filter((e=>!e.exclude)).some((e=>{switch(e.type){case R.COUNTRY:return e.code===t.countryCode;case R.REGION:return e.code===t.regionCode;case R.CITY:return e.code===t.city}}))}return!0})(e,t),[_.likelihoodToConvert]:(e,t,i,s)=>!e.criteria.likelihoodToConvert||e.criteria.likelihoodToConvert===s.likelihoodBucket,[_.webTraffic]:(e,t,i,s)=>!e.criteria.webTraffic||e.criteria.webTraffic.countryCode===t.countryCode,[_.partySize]:(e,t,i,s)=>{if(e.criteria.partySize){if(!t.latestSearch||void 0===t.latestSearch.adults)return!1;const i=+(t.latestSearch.adults||0),s=+(t.latestSearch.children||0);switch(e.criteria.partySize){case"individual":return 1===i&&0===s;case"couple":return 2===i&&0===s;case"family":return i>=1&&s>=1;case"group":return i>=3}}return!0},[_.deviceType]:(e,t,i,s)=>!e.criteria.deviceType||(e.criteria.deviceType===I.mobile?t.isMobile:!t.isMobile),[_.pageTypes]:(e,t,i,s)=>Array.isArray(e.criteria.pageTypes)?e.criteria.pageTypes.some((e=>i.pageType===e)):i.pageType!==P.Confirmation,[_.userTypes]:(e,t,i,s)=>!Array.isArray(e.criteria.userTypes)||e.criteria.userTypes.some((e=>e===A.Unknown||i.userTypes?.includes(e)))},He={now:()=>new Date},Ge=[_.compoundBetween,_.inXDays,_.afterXDays,_.compoundDurations,_.daysOfWeek],Xe=[_.referrers,_.urlInclusions,_.urlExclusions,_.locations,_.newVsReturning,_.likelihoodToConvert,_.partySize,_.deviceType,_.userTypes,_.tripteaseChannels,_.metaParityStatus],Je=[_.userTypes,_.metaParityStatus,_.tripteaseChannels,_.likelihoodToConvert,_.newVsReturning,_.locations,_.referrers,_.urlInclusions,_.compoundBetween,_.inXDays,_.afterXDays,_.compoundDurations,_.daysOfWeek,_.urlExclusions,_.partySize,_.deviceType],Ze=e=>{let t=[];return e.criteria.checkInDates&&(t=t.concat(Object.keys(e.criteria.checkInDates).filter((e=>Ge.indexOf(e)>-1)))),t=t.concat(Object.keys(e.criteria).filter((e=>Xe.indexOf(e)>-1))),t.sort(((e,t)=>Je.indexOf(e)-Je.indexOf(t))),t};function Ye(e,t){const i=Ze(e),s=Ze(t);if(i.length!==s.length)return s.length-i.length;const[a,r]=((e,t)=>{const i=e.filter((e=>-1===t.indexOf(e)))[0];return i?[i,t.filter((t=>-1===e.indexOf(t)))[0]]:[]})(i,s);return((e,t)=>Je.indexOf(e)-Je.indexOf(t))(a,r)}const Qe=864e5,et=Qe;function tt(e,t,i,s){const{key:a,messageReveals:r}=i,n=ve(a,t,e);return Boolean(r&&r[n]&&Date.now()-r[n]>6e4&&Date.now()-r[n]<s)}var it=function(e,t,i,{diagnostics:s}=g()){const a=!function(e,t,i){const{key:s,messageDismisses:a}=i,r=ve(s,t,e);return Boolean(a&&a[r])}(e,t,i),r=!function(e,t,i,s){const{key:a,messageDismisses:r}=i,n=ve(a,t,e);return Boolean(r&&Date.now()-r[n]<s)}(e,t,i,et),n={type:e,dismissedInLastDay:r,seenInLastDay:!tt(e,t,i,et),dismissed:a,seenInLastSevenDays:!tt(e,t,i,6048e5)},o=function({type:e,dismissedInLastDay:t,seenInLastDay:i,dismissed:s,seenInLastSevenDays:a}){switch(e){case p.inline:return i;case p.saveTheSearch:return t&&i;case p.nudge:case p.countdown:return s&&i;case p.fullScreen:return s&&a;case p.crisis:return t&&i;case p.emailCapture:return s;default:return!0}}(n);return o||s.addEvent("seenTooRecently",[t],n),o},st={},at=256,rt=[],nt=void 0===t?window:t,ot=Math.pow(at,6),ct=Math.pow(2,52),lt=2*ct,dt=255,ut=Math.random;function gt(e){var t,i=e.length,s=this,a=0,r=s.i=s.j=0,n=s.S=[];for(i||(e=[i++]);a<at;)n[a]=a++;for(a=0;a<at;a++)n[a]=n[r=dt&r+e[a%i]+(t=n[a])],n[r]=t;(s.g=function(e){for(var t,i=0,a=s.i,r=s.j,n=s.S;e--;)t=n[a=dt&a+1],i=i*at+n[dt&(n[a]=n[r=dt&r+t])+(n[r]=t)];return s.i=a,s.j=r,i})(at)}function pt(e,t){var i,s=[],a=(typeof e)[0];if(t&&"o"==a)for(i in e)try{s.push(pt(e[i],t-1))}catch(e){}return s.length?s:"s"==a?e:e+"\0"}function ht(e,t){for(var i,s=e+"",a=0;a<s.length;)t[dt&a]=dt&(i^=19*t[dt&a])+s.charCodeAt(a++);return ft(t)}function mt(e){try{return nt.crypto.getRandomValues(e=new Uint8Array(at)),ft(e)}catch(e){return[+new Date,nt,nt.navigator&&nt.navigator.plugins,nt.screen,ft(rt)]}}function ft(e){return String.fromCharCode.apply(0,e)}st=function(e,t){if(t&&!0===t.global)return t.global=!1,Math.random=st(e,t),t.global=!0,Math.random;var i=t&&t.entropy||!1,s=[],a=(ht(pt(i?[e,ft(rt)]:0 in arguments?e:mt(),3),s),new gt(s));return ht(ft(a.S),rt),function(){for(var e=a.g(6),t=ot,i=0;e<ct;)e=(e+i)*at,t*=at,i=a.g(1);for(;e>=lt;)e/=2,t/=2,i>>>=1;return(e+i)/t}},st.resetGlobal=function(){Math.random=ut},ht(Math.random(),rt);var wt=(t,i)=>{const{variants:s,...a}=t,r=1===s.length?s[0]:((t,i)=>e(st)(i)()<.5?t[0]:t[1])(s,i);return{...a,...r}};var yt=function(){return window.ga?function(){const e=window.ga;if(e&&e.getAll){const t=e.getAll();if(t.length&&t[0]&&t[0].get)return t[0].get("linkerParam")}return null}():window._gat?function(){try{return window._gat._getTrackers()[0]._getLinkerUrl("http://madeup.com/").replace("http://madeup.com/?","")}catch(e){return null}}():null};function bt(e){return e.indexOf("?")>-1?"&":"?"}function vt(e,t){const i=function(e){if(e.match(/#[^_!\\/]|#$/))return e.substring(e.indexOf("#"))}(e);if(i){const s=function(e,t){return e.substring(0,e.indexOf(t))}(e,i);return`${s}${bt(e)}${t}${i}`}return`${e}${bt(e)}${t}`}var kt=e=>{const t=yt();return t&&"ctaHref"in e.content.copy&&e.content.copy.ctaHref?{...e,content:{...e.content,copy:{...e.content.copy,ctaHref:vt(e.content.copy.ctaHref,t)}}}:e};const St=["HANDPICKEDHOTELS"],Tt=({messageType:e,messages:t,internalState:i,externalState:s,likelihoodToConvert:a,userId:r,logger:n})=>{const o=t.map((e=>wt(e,r))).filter((t=>t.type===e&&(({internalState:e,externalState:t,message:i,likelihoodToConvert:s,logger:a,clock:r=He})=>{if(i.criteria.checkInDates&&!e.latestSearch)return a.info(`Message ${i.id} (${i.type}) - some criteria not valid: check-in date present but there has not been a search`),a.diagnostics.addEvent("onlyShowsOnBookingEngine",[i.id]),!1;const n=Object.entries(Fe).filter((([,a])=>!a(i,e,t,s,r))).map((([e])=>e)),o=0===n.length;return o?a.info(`Message ${i.id} (${i.type}) - all criteria validated`):(a.diagnostics.addEvent("criteriaNotFulfilled",[i.id],n),a.info(`Message ${i.id} (${i.type}) - some criteria not valid: ${n}`)),o})({message:t,internalState:i,externalState:s,likelihoodToConvert:a,logger:n})&&it(e,t.id,i))).sort(Ye);if(!o.length)return null;const[c,...l]=o;return n.info(`Valid messages for type ${e}:`,o),n.diagnostics.addEvent("lowerPriorityCriteria",l.map((e=>e.id))),St.includes(c.client)?(n.info(`Skipping GA tracking enrichment for ${c.client}`),c):(n.info("Adding GA tracking enrichment"),kt(c))},Ct=[];function xt({messagePerType:e,apiKey:t,trackingEnrichment:i,experimentId:s,bucketLabel:a}){const r=Object.entries(e).filter((([,e])=>!!e)).filter((([,e])=>Ct.indexOf(e.id)<0)).map((([e,r])=>r&&{eventAppName:w.messageEngine,eventName:w.messageAvailable,payload:{...i,apiKey:t,messageType:e,messageId:r.id,experimentId:s,bucketLabel:a}})).filter((e=>!!e));r.length&&((e=>{const t={eventName:e.map((e=>e.eventName)).join(",")};re({url:`${se.zappyUrl}/event?${ce(t)}`,body:e.map((e=>le(e)))})})(r),r.forEach((e=>Ct.push(e.payload.messageId))))}let Dt,_t,It=[],Pt=!1,At=[];function Rt(e,t){document.addEventListener(e,t),At.push({eventName:e,handler:t})}const Et=e=>{if(!Pt){const e=e=>{It.forEach((t=>{t(e)})),It=[],At.forEach((({eventName:e,handler:t})=>document.removeEventListener(e,t))),window.clearTimeout(Dt),window.clearTimeout(_t),At=[],Pt=!1};Nt(e),Ot(e),Mt(e),Pt=!0}It.push(e)},Nt=e=>{let t,i=!1;Rt("keydown",(s=>{s.ctrlKey||s.metaKey?(i=!0,t=window.setTimeout((()=>{i&&e("keyDown")}),500)):(i=!1,window.clearTimeout(t))})),Rt("keyup",(e=>{e.ctrlKey||e.metaKey||(i=!1,window.clearTimeout(t))}))},Ot=e=>{function t(){window.clearTimeout(Dt),Dt=window.setTimeout((()=>e("onIdle")),6e4)}t(),Rt("mousemove",t),Rt("scroll",t),Rt("keypress",t)},Mt=e=>{Rt("mouseout",(t=>{t.clientY<2&&null===t.relatedTarget&&(_t=window.setTimeout((()=>{e("onMouseLeave")}),335))})),Rt("mousemove",(e=>{e.clientY>=2&&window.clearTimeout(_t)}))},Ut=[],Wt=(e=Ut)=>{e.push(document.activeElement)};var $t=async({apiKey:e,messageId:t,guestEmail:i,pageReferer:s,firstName:a,lastName:r,fullName:n,pageVisitId:o})=>{const c=se.campaignServiceUrl;try{return await ae({url:`${c}/${e}/${t}/capture-guest-email`,method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({guestEmail:i,pageReferer:s,firstName:a,lastName:r,fullName:n,pageVisitId:o})})}catch(e){return{status:500}}};const Lt=[{name:"synxis",createDeepLink:(e,t)=>{const{hostname:i,searchParams:s}=new URL(e),a=s.get("chain")||s.get("Chain"),r=s.get("hotel")||s.get("Hotel"),n=s.get("promo")||void 0,o=s.get("currency")||"USD",c=new URLSearchParams({arrive:[xe(t.checkin),De(t.checkin),_e(t.checkin)].join("-"),depart:[xe(t.checkout),De(t.checkout),_e(t.checkout)].join("-"),adult:String(t.adults),child:String(t.children),rooms:"1",...a?{chain:a}:{},...r?{hotel:r}:{},...n?{promo:n}:{},level:"hotel",start:"availresults",locale:"en-US",currency:o}),l=new URL(`https://${i}`);return l.search=c.toString(),l.href},testUrl:e=>/gc\.synxis\.com/.test(e)||/be\.synxis\.com/.test(e)||/chain=\d+/.test(e)&&/hotel=\d+/.test(e)}];function Vt(e,t,i){try{const i=new URL(function(e,t){const i=Lt.filter((t=>t.testUrl(e)));return i.length>=1&&i[0]?i[0].createDeepLink(e,t):e}(e,t));return i.searchParams.set("tt_channel","savesearch"),i.href}catch(e){i.error(e)}return e}function Kt(e,t){return e.messagePerType[t]&&e.messagePerType[t].display&&e.messagePerType[t].display.after||0}const zt={[p.crisis]:p.crisis,[p.fullScreen]:p.fullScreen,[p.undercut]:p.undercut,[p.priceCheck]:p.priceCheck,[p.saveTheSearch]:p.saveTheSearch,[p.emailCapture]:p.emailCapture,[p.inline]:p.inline,[p.inPage]:p.inPage,[p.nudge]:p.nudge,[p.countdown]:p.countdown,[p.notifications]:p.notifications,[p.previewAssist]:p.previewAssist};var Bt=async function(e,t){try{const{data:a}=t;if(a&&a.type){const r=e.isMobile;switch(a.type){case m.platformUpdate:{const i=t.data.payload.messageType;zt[i]&&e.sendDataToWidget(zt[i],m.messageEngineWidgetData,{message:t.data.payload.message});break}case m.nudgeReady:e.sendDataToWidget(p.nudge,m.messageEngineWidgetData,{message:e.messagePerType[p.nudge]}),setTimeout((()=>{e.showWidget(p.nudge,"timeout")}),Kt(e,p.nudge));break;case m.countdownReady:e.sendDataToWidget(p.countdown,m.messageEngineWidgetData,{message:e.messagePerType[p.countdown]}),setTimeout((()=>{e.showWidget(p.countdown,"timeout")}),Kt(e,p.countdown));break;case m.messageReveal:e.messageLocalStorage&&e.messageLocalStorage.updateMessageReveals(a.payload.messageId,a.payload.messageType);break;case m.emailCaptureReady:e.sendDataToWidget(p.emailCapture,m.messageEngineWidgetData,{message:e.messagePerType[p.emailCapture]}),setTimeout((()=>{e.showWidget(p.emailCapture,"timeout")}),Kt(e,p.emailCapture));break;case m.undercutReady:e.styleWidget(p.undercut,["display","block","important"]),e.sendDataToWidget(p.undercut,m.messageEngineWidgetData,{message:e.messagePerType[p.undercut]});break;case m.priceCheckReady:e.styleWidget(p.priceCheck,["display","block","important"]),e.sendDataToWidget(p.priceCheck,m.messageEngineWidgetData,{message:e.messagePerType[p.priceCheck],isMobile:r,pricingData:e.pricingData});break;case m.inlineReady:e.styleWidget(p.inline,["display","block","important"]),e.sendDataToWidget(p.inline,m.messageEngineWidgetData,{message:e.messagePerType[p.inline]});break;case m.previewAssistReady:e.styleWidget(p.previewAssist,["display","block","important"]);const n=!Object.entries(e.widgetIframes).filter((([e,t])=>e!==p.previewAssist&&t)).length;e.sendDataToWidget(p.previewAssist,m.messageEngineWidgetData,{error:n});break;case m.inPageReady:e.styleWidget(p.inPage,["display","block","important"]),e.sendDataToWidget(p.inPage,m.messageEngineWidgetData,{message:e.messagePerType[p.inPage],isMobile:r,pricingData:e.pricingData});break;case m.notificationsReady:e.styleWidget(p.notifications,["display","block","important"]),e.sendDataToWidget(p.notifications,m.messageEngineWidgetData,{notifications:e.notifications});break;case m.saveTheSearchReady:!function(e,t){const i=e.messagePerType[p.saveTheSearch],s=function({hotelName:e,pageTitle:t,pageUrl:i,search:s},a){const r=s?Vt(i,s,a):i,n=e||t||"",o=function(e,t){return[e,t?.checkin?.toDateString(),t?.checkout?.toDateString(),t?.adults,t?.children].filter((e=>!!e)).join(" | ")}(n,s);return{title:n,text:o,url:r}}(e.externalState,e.logger);if(i){const a={message:i,isMobile:t,shareData:s};e.sendDataToWidget(p.saveTheSearch,m.messageEngineWidgetData,a);const r=Kt(e,p.saveTheSearch);if(t)setTimeout((()=>{e.showWidget(p.saveTheSearch,"timeout")}),r);else{const t=0;e.logger.info(`Showing save the search on exit with delay of ${t}ms`),setTimeout((()=>{Et((t=>{Wt(),e.showWidget(p.saveTheSearch,t),e.focusWidget(p.saveTheSearch)}))}),t)}}}(e,r);break;case m.fullScreenReady:{const t=e.messagePerType[p.fullScreen];if(e.sendDataToWidget(p.fullScreen,m.messageEngineWidgetData,{message:t}),t){const i=t.display&&t.display.triggerDelay||0;e.logger.info(`Showing fullScreen on exit with delay of ${i}ms`),setTimeout((()=>{Et((t=>{Wt(),e.showWidget(p.fullScreen,t),e.focusWidget(p.fullScreen)}))}),i)}break}case m.crisisReady:{const t=e.messagePerType[p.crisis];if(e.sendDataToWidget(p.crisis,m.messageEngineWidgetData,{message:t}),t){const i=t.display&&t.display.after;e.logger.info(`Showing crisis on entry with delay of ${i}ms`),setTimeout((()=>{Wt(),e.showWidget(p.crisis,"timeout"),e.focusWidget(p.crisis)}),i)}break}case m.forceFullScreenVisible:e.showWidget(p.fullScreen,"trigger");break;case m.trackEventZappy:de({eventName:a.eventName,eventAppName:a.eventAppName,payload:{campaignId:a.messageId,campaignType:a.messageType,propensityToConvertVersion:a.eventName===w.opened||a.eventName===w.closed?e.likelihoodToConvert&&e.likelihoodToConvert.version:void 0,apiKey:e.internalState&&e.internalState.key,...e.trackingEnrichment,...a.payload,version:e.internalState&&e.internalState.version,timeTaken:t.data.eventName===w.priceCheckReveal&&e.startTime?window.performance.now()-e.startTime:void 0}});break;case m.trackEvent:{const e=a.payload;i=e.type,s=e.payload,window.postMessage({type:"triptease.event",event:i,context:{app:{name:"MessageEngine",version:20220914140323}},payload:s},"*");break}case m.messageDismiss:{const{messageId:t,messageType:i}=a.payload;i!==p.saveTheSearch&&i!==p.fullScreen&&i!==p.crisis||((e=Ut)=>{const t=e[e.length-1];t&&t.focus()})(),e.messageLocalStorage&&e.messageLocalStorage.updateMessageDismisses(t,i),e.removeWidget(i);break}case m.widgetDimensionsChange:{const{messageType:t,width:i,height:s}=a.payload;void 0!==i&&e.styleWidget(t,["width",i,"important"]),void 0!==s&&e.styleWidget(t,["height",s,"important"]);break}case m.localStorageClear:e.localStorage&&e.localStorage.clearAll();break;case m.optOutOfExperiments:e.localStorage&&e.localStorage.set(f.optOutOfExperiments,"true");break;case m.captureGuestEmail:await async function(e,t){const i=e.internalState&&e.internalState.key,s=e.externalState?.pageUrl,{messageId:a,guestEmail:r,firstName:n,lastName:o,fullName:c}=t.payload;if(i&&s){const t=await $t({apiKey:i,messageId:a,guestEmail:r,pageReferer:s,firstName:n,lastName:o,fullName:c,pageVisitId:e.externalState?.pageVisitId});e.sendDataToWidget(p.emailCapture,m.emailRequestFinish,t)}}(e,a)}}}catch(t){e.logger.error(t)}var i,s};const jt=async(e,t,i,s)=>(({logger:e,...t})=>{e.info("Deciding which messages to handle",t);const{saveTheSearch:i,nudge:s,fullScreen:a,priceCheck:r,inPage:n,undercut:o,emailCapture:c,crisis:l,countdown:d,inline:u}=p,{webShareAPIAvailable:g,localStorageAvailable:h,isMobile:m,pageType:f}=t,w=f===P.RoomsAndRates,y=f===P.Confirmation,b=[...w&&!m?[o]:[],...w?[r,n]:[]];if(!h)return b;const v=!m||g,k=[...b,...y||m?[]:[c,s,d,a,n,l],...!y&&m?[n,s,d]:[],...y?[s]:[],...w&&v?[i]:[],u];return e.diagnostics.addHandledMessageTypes(k,t),k})({localStorageAvailable:await i.isAvailable(),webShareAPIAvailable:await i.webShareAPIAvailable(),pageType:e.pageType,isMobile:t,logger:s});var qt=({notificationType:e,apiKey:t,messageDismisses:i})=>{const s=ve(t,e,p.notifications);return Boolean(i&&Date.now()-i[s]<Qe)};var Ft=({externalState:e,internalState:{key:t,messageDismisses:i},notificationType:s})=>e.pageType===P.RoomsAndRates&&!qt({notificationType:s,apiKey:t,messageDismisses:i});var Ht=({externalState:e,internalState:{key:t,messageDismisses:i,latestVisitInfo:s},getCurrentTime:a=Date.now})=>e.pageType!==P.RoomsAndRates&&!qt({notificationType:h.location,apiKey:t,messageDismisses:i})&&(({latestVisitInfo:e,numberOfPages:t})=>e.pageViews>=t)({latestVisitInfo:s,numberOfPages:2})&&(({latestVisitInfo:e,time:t,getCurrentTime:i})=>i()-t>=e.firstSeen)({latestVisitInfo:s,time:3e4,getCurrentTime:a});var Gt=function(e,t){e&&e.contentWindow&&e.contentWindow.postMessage(t,"*")};function Xt({iframe:e,trigger:t}){Gt(e,{type:m.messageEngineShowWidget,payload:{show:!0,trigger:t}})}var Jt=function(e,t){e&&e.contentWindow&&(e.style.setProperty("display","block","important"),window.requestAnimationFrame?window.requestAnimationFrame((()=>Xt({iframe:e,trigger:t}))):Xt({iframe:e,trigger:t}))};let Zt;!function(e){e.bestDirect="bestDirect",e.allUndercut="allUndercut",e.unknown="unknown"}(Zt||(Zt={}));const Yt={},Qt={left:"0",top:"0"},ei={left:"0",bottom:"0"},ti={left:"0",right:"0",bottom:"0"},ii={[p.saveTheSearch]:{mobile:ti,desktop:Qt},[p.countdown]:{mobile:ei,desktop:ei},[p.crisis]:{mobile:Yt,desktop:Qt},[p.emailCapture]:{mobile:Yt,desktop:ei},[p.fullScreen]:{mobile:Yt,desktop:Qt},[p.inPage]:{mobile:Yt,desktop:Qt},[p.inline]:{mobile:Yt,desktop:Qt},[p.notifications]:{mobile:Yt,desktop:{right:"0",top:"80px"}},[p.nudge]:{mobile:ei,desktop:ei},[p.priceCheck]:{mobile:ti,desktop:{right:"6px",bottom:"6px"}},[p.undercut]:{mobile:Yt,desktop:{right:"0",bottom:"0"}},[p.previewAssist]:{mobile:Yt,desktop:{top:"0px"}}};function si(e){return!!e&&["top","right","bottom","left"].some((t=>e.hasOwnProperty(t)))}var ai=()=>{if(!document.getElementById("tt_styles")){const t=document.createElement("style");t.id="tt_styles",t.appendChild(document.createTextNode(e(".tt_widget{background:transparent;border:0;display:none;position:fixed;user-select:none}.tt_widget.tt_widget--platform{position:absolute}#tt_countdown,#tt_nudge{height:212px;max-width:100%!important;width:100%!important;z-index:2147483645}@media (min-width:432px){#tt_countdown,#tt_nudge{max-width:432px!important}}#tt_email-capture{height:200px;width:440px;z-index:2147483644}#tt_undercut{height:260px;width:280px;z-index:2147483643}#tt_price-check{height:260px;opacity:1!important;visibility:visible!important;width:254px;z-index:2147483642}#tt_price-check.tt_widget--mobile{height:0;width:100%;z-index:2147483642}#tt_preview-assist.tt_widget--preview{background:transparent;display:block;user-select:auto;width:100%}#tt_notifications{height:0;right:0;top:80px;width:0;z-index:2147483641}#tt_full-screen{height:100%;width:100%;z-index:2147483647}#tt_in-page,#tt_inline{height:0;position:relative;width:100%}#tt_crisis,#tt_save-the-search{height:100%;width:100%;z-index:2147483647}"))),document.head.appendChild(t)}};class ri{trackPlacementSelector(e,t){de({eventName:w.placementSelector,eventAppName:w.messageEngine,payload:{found:e,messageId:t.id,messageType:t.type,variantId:t.variantId,pageUrl:this.externalState.pageUrl,apiKey:this.internalState.key,pageVisitId:this.externalState.pageVisitId,userId:this.externalState.userId,sessionId:this.externalState.sessionId,clientName:this.externalState.clientName}})}prepareIframe(e,t){e.setAttribute("title","Overlay Message"),e.setAttribute("id",`tt_${t}`);const i=this.internalState.isMobile?" tt_widget--mobile":"",s=this.externalState.isPreview?" tt_widget--preview":"";e.setAttribute("class",`tt_widget${i}${s}`),ai()}createWidgetIframe(e,t,i={}){const s=document.createElement("iframe");s.src=ni[e],this.prepareIframe(s,e);const a=this.getIframeStylesForMessage(t);return Object.entries(a).forEach((([e,t])=>{void 0!==t&&s.style.setProperty(e,t,"important")})),Object.entries(i).forEach((([e,t])=>{void 0!==t&&s.style.setProperty(e,t,"important")})),s}getMessagePosition(e){const t=this.internalState.isMobile,i=t?e.messagePositionMobile:e.messagePosition;return si(i)?function(e,t){return{top:e.top||"auto",right:e.right||(t?"0px":"auto"),bottom:e.bottom||"auto",left:e.left||(t?"0px":"auto")}}(i,t):function(e,t){return ii[e.type][t?"mobile":"desktop"]||{}}(e,t)}getMessageZIndex(e){return this.internalState.isMobile&&e.messagePositionMobile?e.messagePositionMobile["z-index"]:e.messagePosition?e.messagePosition["z-index"]:void 0}getIframeStylesForMessage(e){if(!e)return{};const t=this.getMessageZIndex(e);return{...this.getMessagePosition(e),...t&&{"z-index":t}}}addPreviewInfoWidget(e){Object.entries({right:"0",top:"0",left:"0","z-index":"100000"}).forEach((([t,i])=>{void 0!==i&&e.style.setProperty(t,i,"important")})),document.body.appendChild(e)}loadPopUpWidget(e,t){const i=this.createWidgetIframe(e,t||null);return document.body.appendChild(i),this.logger.info(`Added ${e} to document body`),i}loadEmbeddedWidget(e,t){const i=function(e){try{return document.evaluate(e,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}catch(e){return null}}(t.placementSelector);if(this.externalState.isPreview||this.trackPlacementSelector(!!i,t),i){let t=function(e){return{padding:window.getComputedStyle(e)?.padding,"padding-bottom":"0px","padding-top":"0px"}}(i);const s=this.createWidgetIframe(e,null,t);return i.parentNode&&i.parentNode.insertBefore(s,i.nextSibling),this.logger.info(`Added ${e} to document body`),s}this.logger.warn(`No target element found for InPage widget with placementSelector ${t.placementSelector}`)}loadPreviewAssist(){const e=document.createElement("iframe");return e.src=se.previewAssistSrc,this.prepareIframe(e,p.previewAssist),this.addPreviewInfoWidget(e),this.logger.info("Added preview assist to document body"),e}constructor(e,t,i){this.logger=e,this.internalState=t,this.externalState=i}}const ni={[p.saveTheSearch]:se.saveTheSearchSrc,[p.nudge]:se.nudgeSrc,[p.countdown]:se.countdownSrc,[p.undercut]:se.undercutSrc,[p.priceCheck]:se.priceCheckSrc,[p.notifications]:se.notificationsSrc,[p.fullScreen]:se.fullScreenSrc,[p.crisis]:se.crisisSrc,[p.inline]:se.inlineSrc,[p.inPage]:se.inPageSrc,[p.emailCapture]:se.emailCaptureSrc,[p.previewAssist]:se.previewAssistSrc};class oi{loadSaveTheSearch(){const e=this.messagePerType[p.saveTheSearch];if(e)return this.loader.loadPopUpWidget(p.saveTheSearch,e)}loadEmailCapture(){const e=this.messagePerType[p.emailCapture];if(e)return this.loader.loadPopUpWidget(p.emailCapture,e)}loadNudge(){const e=this.messagePerType[p.nudge];if(e)return this.loader.loadPopUpWidget(p.nudge,e)}loadCountdown(){const e=this.messagePerType[p.countdown];if(e)return this.loader.loadPopUpWidget(p.countdown,e)}loadFullScreen(){const e=this.messagePerType[p.fullScreen];if(e)return this.loader.loadPopUpWidget(p.fullScreen,e)}loadCrisis(){const e=this.messagePerType[p.crisis];if(e)return this.loader.loadPopUpWidget(p.crisis,e)}loadNotifications(){if(this.notifications)return this.loader.loadPopUpWidget(p.notifications)}loadInline(){const e=this.messagePerType[p.inline];if(e)return this.loader.loadEmbeddedWidget(p.inline,e)}loadInPage(e){const t=this.messagePerType[p.inPage];if(t&&(t.content.type!==v.PriceCheck||e))return this.loader.loadEmbeddedWidget(p.inPage,t)}loadPriceCheck(e){const t=this.messagePerType[p.priceCheck];if(t&&e&&e.pricingScenario===Zt.bestDirect)return this.loader.loadPopUpWidget(p.priceCheck,t)}loadUndercut(e,t){const i=this.messagePerType[p.undercut];if(i&&(t&&t.pricingScenario===Zt.allUndercut||e))return this.loader.loadPopUpWidget(p.undercut,i)}loadPreviewAssist(){return this.loader.loadPreviewAssist()}constructor(e,t,i,s,a,r){this.logger=e,this.internalState=t,this.externalState=i,this.messagePerType=s,this.notifications=a,this.loader=r||new ri(this.logger,this.internalState,this.externalState)}}const ci=[p.priceCheck,p.countdown,p.emailCapture,p.nudge,p.notifications,p.undercut],li=[p.crisis,p.fullScreen,p.saveTheSearch],di={[p.saveTheSearch]:{desktop:"",mobile:"bottom"},[p.notifications]:{desktop:"top_right",mobile:""},[p.priceCheck]:{desktop:"bottom_right",mobile:"bottom"},[p.nudge]:{desktop:"bottom_left",mobile:"bottom"},[p.countdown]:{desktop:"bottom_left",mobile:"bottom"},[p.emailCapture]:{desktop:"bottom_left",mobile:""},[p.undercut]:{desktop:"bottom_right",mobile:""},[p.fullScreen]:{desktop:"center",mobile:""},[p.crisis]:{desktop:"center",mobile:""},[p.inline]:{desktop:"",mobile:""},[p.inPage]:{desktop:"",mobile:""},[p.saveTheSearch]:{desktop:"center",mobile:"bottom"},[p.previewAssist]:{desktop:"center",mobile:"bottom"}};function ui(e){return e&&e.top?"top":"bottom"}function gi(e,t,i){const s={},a={},r={};let n=t;Object.values(e).forEach((e=>{if(!e)return;const t=function(e,t){const i=t?e.messagePositionMobile:e.messagePosition;if(si(i))return t?`${ui(i)}`:`${ui(i)}_${function(e){return e&&e.left?"left":"right"}(i)}`;const s=di[e.type];return t?s.mobile:s.desktop}(e,i);var n,o;t?(s[e.type]=t,a[t]?a[t]=li.includes(e.type)?(n=a[t],o=e,li.indexOf(n.type)<li.indexOf(o.type)?n:o):function(e,t){return ci.indexOf(e.type)<ci.indexOf(t.type)?e:t}(a[t],e):a[t]=e):r[e.type]=e})),t&&a.top_right&&(ci.indexOf(p.notifications)<ci.indexOf(a.top_right.type)?delete a.top_right:n=void 0);const o=Object.values(a).reduce(((e,t)=>({...e,[t.type]:t})),r);return s[p.priceCheck]&&s[p.undercut]&&s[p.priceCheck]===s[p.undercut]&&(o[p.priceCheck]&&(o[p.undercut]=e[p.undercut]),o[p.undercut]&&(o[p.priceCheck]=e[p.priceCheck])),{messages:o,notifications:n}}const pi=(e,t)=>Object.entries(e).filter((([e])=>!(e in t))).map((([,e])=>e.id)),hi=(e,t)=>Boolean(e&&!t);var mi=async({messageId:e,client:t,apiKey:i,config:s=se,logger:a})=>{try{const r=await ae({url:`${s.campaignServiceUrl}/client/${t}/${i}/campaign/${e}`});return 200===r.status?JSON.parse(r.body):void a.error(`Call to get preview message ${e} failed. No message found`)}catch(e){a.error(e)}};const fi=(e,t)=>e.filter((e=>null===e.price||e.price.value>=t.price)).sort(((e,t)=>e.price&&t.price?e.price.value-t.price.value:e.price?-1:t.price?1:0));const wi=g(),yi=new class{getPricingData(e,t,i){this.pollApiUntilComplete(e,t,i)}pollApiUntilComplete(e,t,i){if(!t.priceCheckData)return;const s={applications:t.applications,adults:`${t.priceCheckData.adults}`,children:`${t.priceCheckData.children||0}`,checkin:Ce(t.priceCheckData.checkin),checkout:Ce(t.priceCheckData.checkout),rooms:`${t.priceCheckData.rooms||1}`,token:e.key,total:`${!!t.priceCheckData.total}`,rateDetails:t.priceCheckData.rateDetails,promoCodes:t.priceCheckData.promoCodes,allowedRates:t.priceCheckData.allowedRates,excludedRates:t.priceCheckData.excludedRates,allowedPromoCodes:t.priceCheckData.allowedPromoCodes,ratesModified:t.priceCheckData.ratesModified,_cid:t.userId,_sid:t.sessionId,_pid:t.pageVisitId,_ref:t.pageUrl};this.doRequest(t,this.initialPriceRequestCall(s),i)}async doRequest(e,t,i){const s=await t;if(!s||this.latestStatusUrl!==s._links.status)return;this.logger.diagnostics.sendPricingApiResult(s);const a=((e,t)=>{if(t){if((e=>!(e.prices.length<1)&&e.prices.some((({price:t})=>!t||t.value>=e.directRate.price)))(t)){const i=e.priceCheckData?.rateDetails.filter((({tags:e=[]})=>e.includes("non-member"))).map((({price:e,currency:t})=>({price:e,currency:t}))).sort(((e,t)=>e.price-t.price))[0];return{ticketId:t.ticketId,pricingScenario:Zt.bestDirect,directRate:t.directRate,otaPrices:fi(t.prices,t.directRate),nonMemberRate:i,complete:t.complete,searchCriteria:{adults:e.priceCheckData.adults,children:e.priceCheckData.children,checkin:e.priceCheckData.checkin,checkout:e.priceCheckData.checkout,language:e.language}}}return(e=>!(e.prices.length<1)&&!!e.complete&&e.prices.every((({price:t})=>!!(t&&t.value<e.directRate.price))))(t)?{ticketId:t.ticketId,pricingScenario:Zt.allUndercut,directRate:t.directRate,otaPrices:fi(t.prices,t.directRate),complete:t.complete,searchCriteria:{language:e.language,adults:e.priceCheckData.adults,children:e.priceCheckData.children,checkin:e.priceCheckData.checkin,checkout:e.priceCheckData.checkout}}:{ticketId:t.ticketId,pricingScenario:Zt.unknown,directRate:t.directRate,otaPrices:[],complete:t.complete,searchCriteria:{language:e.language,adults:e.priceCheckData.adults,children:e.priceCheckData.children,checkin:e.priceCheckData.checkin,checkout:e.priceCheckData.checkout}}}})(e,s);i(a),s.complete||(await new Promise((e=>setTimeout(e,s.callbackDelay))),this.doRequest(e,this.subsequentPriceRequestCall(`${se.priceCheckApiUrl}${s._links.status}`),i))}async initialPriceRequestCall(e){const t=await fetch(`${se.priceCheckApiUrl}/price-check`,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}),i=await this.handlePriceResponse(t);if(i)return this.latestStatusUrl=i._links.status,i}async subsequentPriceRequestCall(e){const t=await fetch(e);return this.handlePriceResponse(t)}async handlePriceResponse(e){if(200===e.status){const t=await e.json();if(!t||Array.isArray(t))return;return t}}constructor(e){this.logger=e}}(wi),bi=new class{async getMetaParityData(e,t){const i=se.campaignServiceUrl;try{this.logger.info("Getting Meta Parity data");const s=await((e,t=1e4)=>new Promise(((i,s)=>{setTimeout((()=>s(new Error("RequestTimeout"))),t),e.then(i,s)})))(fetch(`${i}/${e.apiKey}/${t}/meta-parity-data`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({apiKey:e.apiKey,checkin:e.search?.checkin,checkout:e.search?.checkout,adults:e.search?.adults})}));return this.handleMetaParityResult(s)}catch(e){return void this.logger.warn("Unable to get any data from Meta Parity API")}}async handleMetaParityResult(e){if(e&&200===e.status){const t=await e.json();if(!t||Array.isArray(t)||!t.data)return;return t}}constructor(e){this.logger=e}}(wi),vi=new class{addNonPriceDataWidgetIframes(e){this.widgetIframes[p.crisis]=e.loadCrisis(),this.widgetIframes[p.fullScreen]=e.loadFullScreen(),this.widgetIframes[p.notifications]=e.loadNotifications(),this.widgetIframes[p.emailCapture]=e.loadEmailCapture(),this.widgetIframes[p.nudge]=e.loadNudge(),this.widgetIframes[p.countdown]=e.loadCountdown(),this.widgetIframes[p.saveTheSearch]=e.loadSaveTheSearch(),this.widgetIframes[p.inline]=e.loadInline()}async loadsChoosesDisplaysMessages(e,t){try{if(this.externalState=e,this.logger.info("External state:",this.externalState),this.logger.info("Removing window event listener"),window.removeEventListener("message",this.onWindowMessage),this.logger.info("Adding window event listener"),window.addEventListener("message",this.onWindowMessage),this.isMobile=function(e){return!!(e.userAgent||"").match(/Mobile|iP(hone|od|ad)|Android|BlackBerry|IEMobile|Kindle|NetFront|Silk-Accelerated|(hpw|web)OS|Fennec|Minimo|Opera M(obi|ini)|Blazer|Dolfin|Dolphin|Skyfire|Zune/)}(e),e.isPreview)return this.handlePreviewMessage();this.localStorage=await this.createLocalStorage(),this.messageLocalStorage=new Se(this.localStorage,t.key);const i={userId:e.userId,sessionId:e.sessionId,pageVisitId:e.pageVisitId,clientName:e.clientName,version:t.version};this.trackingEnrichment=i;const{messages:s,countryCode:a,regionCode:r,city:n,notifications:o,mab:c}=await Te({apiKey:t.key,logger:this.logger,language:e.language});this.logger.diagnostics.addMessages(s.map((e=>e.id))),this.clearAllWidgets();const[l,d,u,g]=await Promise.all([We({localStorage:this.localStorage,apiKey:t.key,currentTimestamp:Date.now(),search:e.search}),$e(this.localStorage,t.key,e.search),this.messageLocalStorage.getMessageReveals(),this.messageLocalStorage.getMessageDismisses()]),m=((e,t,i,s,a,r,n,o,c)=>({key:e.key,version:e.version,countryCode:n,regionCode:o,city:c,latestVisitInfo:t,messageReveals:i,messageDismisses:s,latestSearch:a,isMobile:r}))(t,l,u,g,d,this.isMobile,a,r,n);this.internalState=m,this.logger.info("Internal state:",this.internalState);const f=new Be(m,e);this.likelihoodToConvert=f,this.logger.info("PTC:",this.likelihoodToConvert);const w=await jt(e,this.isMobile,this.localStorage,this.logger);this.logger.info("Handled message types:",w),this.logger.diagnostics.addEvent("messageTypeNotHandled",((e,t)=>{try{return t.filter((t=>!e.includes(t.type))).map((e=>e.id))}catch(e){return[]}})(w,s));const y=w.reduce(((t,a)=>({...t,[a]:Tt({messageType:a,messages:s,internalState:m,externalState:e,likelihoodToConvert:f,userId:i.userId,logger:this.logger})})),{});this.logger.info("Message per type:",y);const b=((e,t,i)=>{const s={};if(!i.isMobile)return e.bookers&&Ft({externalState:t,internalState:i,notificationType:h.bookers})&&(s[h.bookers]=e.bookers),e.searchers&&Ft({externalState:t,internalState:i,notificationType:h.searchers})&&(s[h.searchers]=e.searchers),e.location&&Ht({externalState:t,internalState:i})&&(s.location=e.location),Object.keys(s).length>0?s:void 0})(o,e,m),k=gi(y,b,this.isMobile);this.messagePerType=k.messages,this.notifications=k.notifications,this.logger.info("Non-overlapping message per type:",this.messagePerType),this.logger.diagnostics.addEvent("overlapsWithHigherPriorityMessage",function(e,t,i,s){try{const a=pi(e,t);return hi(i,s)&&a.push("NOTIFICATIONS"),a}catch(e){return[]}}(y,k.messages,b,k.notifications)),this.logger.info("Notifications per type:",this.notifications),xt({messagePerType:this.messagePerType,apiKey:t.key,trackingEnrichment:i,experimentId:c?c.experimentId:void 0,bucketLabel:c?c.armId:void 0});const S=new oi(this.logger,m,e,this.messagePerType,this.notifications);this.addNonPriceDataWidgetIframes(S);const T=Object.entries(this.messagePerType).filter((([e,t])=>!!t&&(e===p.undercut||e===p.priceCheck||e===p.inPage&&t.content.type===v.PriceCheck))).map((([,e])=>e.id));this.logger.diagnostics.addEvent("requiresPricingData",T),T.length&&await this.handleMessagesThatRequirePricingData(e,S,t);Object.entries(this.widgetIframes).filter((([,e])=>!!e)).map((([e])=>e)).length||this.logger.info("Found no messages to use")}catch(e){this.logger.error(e)}finally{this.logger.diagnostics.flush()}}async handlePreviewMessage(e=se,t=this.externalState){this.logger.info("Previewing message");const i=t.pageUrl.split("?")[1],s=(new RegExp("preview=(\\w*)(&?)").exec(i)||[])[1];if(s&&t?.clientName&&t.apiKey){const i=await mi({messageId:s,client:t?.clientName,apiKey:t?.apiKey,config:e,logger:this.logger});if(!i)return;this.messagePerType={[i.type]:wt(i)};const a=new oi(this.logger,{isMobile:this.isMobile},t,this.messagePerType,this.notifications,void 0);this.addNonPriceDataWidgetIframes(a),this.pricingData=((e,t)=>({ticketId:"test",complete:!0,pricingScenario:t===p.undercut?O.allUndercut:O.bestDirect,directRate:{price:205.33,currency:"USD",rateName:"Best Direct"},otaPrices:[{name:"OTA 1",price:{value:206.29,currency:"USD"}},{name:"OTA 2",price:{value:207,currency:"USD"}},{name:"OTA 3",price:null}],searchCriteria:{adults:e.search?.adults||2,children:e.search?.children||1,checkin:e.search?.checkin||new Date,checkout:e.search?.checkout||new Date,language:e?.language}}))(t,i.type),this.handlePriceCheckData(this.pricingData,a,!1),console.log("this.messagePerType",this.messagePerType),console.log("this.widgetIframes",this.widgetIframes),this.widgetIframes[i.type],this.widgetIframes[p.previewAssist]=a.loadPreviewAssist()}else this.logger.error(`Could not get message id or clientName or apiKey, page url ${t.pageUrl}`)}async handleMessagesThatRequirePricingData(e,t,i){this.messagePerType[p.undercut]&&this.messagePerType[p.undercut]?.criteria?.metaParityStatus&&this.messagePerType[p.undercut]?.content.ctaType===k.CopyOnClick&&this.messagePerType[p.undercut]?.content.copy.ctaPromoCode&&je(e.pageUrl)?await this.getMetaParityForUndercut(i,e,t):this.pricingApi.getPricingData(i,e,(e=>{this.handlePriceCheckData(e,t,!1)}))}handlePriceCheckData(e,t,i){this.logger.info("Incoming pricing data",{pricingData:e}),this.pricingData=e,i||!e||e.pricingScenario!==Zt.allUndercut||this.widgetIframes[p.undercut]||(this.widgetIframes[p.undercut]=t.loadUndercut(!1,this.pricingData)),e&&e.pricingScenario===Zt.bestDirect&&!this.widgetIframes[p.priceCheck]&&(this.widgetIframes[p.priceCheck]=t.loadPriceCheck(this.pricingData)),e&&e.pricingScenario===Zt.bestDirect&&!this.widgetIframes[p.inPage]&&(this.widgetIframes[p.inPage]=t.loadInPage(this.pricingData)),e&&e.pricingScenario!==Zt.unknown&&this.sendDataToAllWidgets(m.incomingPricingData,{pricingData:e})}async getMetaParityForUndercut(e,t,i){const s=await this.metaParityApi.getMetaParityData(t,this.messagePerType[p.undercut]?.id);this.logger.info("Received response for meta pricing data",{metaParityData:s}),s&&s.data.status===D.UNDERCUT?this.widgetIframes[p.undercut]=i.loadUndercut(!0):this.pricingApi.getPricingData(e,t,(e=>{this.handlePriceCheckData(e,i,!0)}))}async createLocalStorage(){if(!this.localStorage){const e=await new Promise((e=>{const t=document.createElement("iframe");t.onload=()=>{e(t)},t.src=se.storageIframeSrc,t.title="blank",t.setAttribute("aria-hidden","true"),t.setAttribute("style","display: none; height: 0; width: 0;"),document.body.appendChild(t)}));this.localStorage=new me(e,window)}return this.localStorage}constructor(e,t,i,s){this.logger=e,this.pricingApi=t,this.metaParityApi=i,this.localStorage=s,this.onWindowMessage=Bt.bind(void 0,this),this.removeWidget=e=>{try{const t=this.widgetIframes[e];t&&(t.style.setProperty("display","none"),t.remove())}catch(e){this.logger.error(e)}},this.styleWidget=(e,t)=>{try{const i=this.widgetIframes[e];i&&i.style&&i.style.setProperty(...t)}catch(e){this.logger.error(e)}},this.sendDataToWidget=(e,t,i)=>{try{const s=this.widgetIframes[e];s&&Gt(s,{type:t,payload:i})}catch(e){this.logger.error(e)}},this.sendDataToAllWidgets=(e,t)=>{try{Object.values(this.widgetIframes).forEach((i=>{i&&Gt(i,{type:e,payload:t})}))}catch(e){this.logger.error(e)}},this.showWidget=(e,t)=>{try{const i=this.widgetIframes[e];i&&Jt(i,t)}catch(e){this.logger.error(e)}},this.focusWidget=e=>{try{const t=this.widgetIframes[e];t&&t.focus()}catch(e){this.logger.error(e)}},this.clearAllWidgets=()=>{(()=>{let e;for(;e=document.querySelector("iframe.tt_widget");)e&&e.parentNode&&e.parentNode.removeChild(e)})(),this.widgetIframes={}},this.widgetIframes={},this.messagePerType={},this.isMobile=!1,this.startTime=window.performance.now()}}(wi,yi,bi);new class{tryToRun(e){const t=he(e);if(!t)return;const i=(s=t,!(a=this.previousExternalState)||!V(s,a));var s,a;const r=((e,t)=>{for(const i of L)if(!e[i])return t.info(`Not enough external state to run, missing property ${i}`),!1;return e.clientKey||e.apiKey?!!(e.pageType!==P.RoomsAndRates||e.search&&e.search.checkin&&e.search.checkout)||(t.info("Not enough external state to run, as we are on rooms and rates page, but do not have checkin and checkout data"),!1):(t.info("Not enough external state to run, we need either a clientKey or an apiKey"),!1)})(t,this.logger);i&&r&&(this.externalState=t,this.actuallyRun())}actuallyRun(){if(!this.externalState)return;const e=(e=>{if(!e.apiKey&&!e.clientKey)throw Error("No apiKey or clientKey so message-engine can't execute");return{key:e.apiKey||e.clientKey,version:20220914140323}})(this.externalState);if(this.previousExternalState&&this.previousExternalState.clientKey&&!this.previousExternalState.apiKey&&this.externalState.apiKey&&this.externalState.pageUrl===this.previousExternalState.pageUrl){const t=new oe(this.externalState,e),i={eventAppName:U.messageEngine,eventName:M.events,event:"api_key_change_on_same_page"};t.track(i)}this.previousExternalState=this.externalState,this.messageController.loadsChoosesDisplaysMessages(this.externalState,e)}constructor(e,t){this.onTripteaseConfigMessage=e=>{try{e.data&&e.data.type===$.Config&&(this.logger.info("Received triptease config update:",e.data),this.tryToRun(e.data))}catch(e){this.logger.error(e)}},this.logger=e,this.messageController=t,this.logger.info("Init Bootstrap Message Engine"),this.logger.info("VERSION","20220914140323"),this.logger.info("COMMIT_HASH","82cbac2c86bf62c5a4be185ae3ecdd5d6b4696f9"),window.addEventListener("message",this.onTripteaseConfigMessage)}}(wi,vi)}();