function ttRetargeting(){var s=window&&window.document||document,o=window.BEE_SERVER_URL||"https://b.triptease.io",t=window.BEE_WINDOW_LOCATION_URL||window.location.href,a=!!function(e){if(t){e=t.match(new RegExp(e+"=([^&]*)"));return e&&e[1]}return}("tt_rt"),c="",d=[],p=[];function u(e,t,r){var i;s.getElementById(t)||((i=s.createElement(e)).setAttribute("id",t),i.setAttribute("src",r),i.setAttribute("width","0"),i.setAttribute("height","0"),i.setAttribute("style","display: none"),"iframe"===e&&(i.setAttribute("title","blank"),i.setAttribute("aria-hidden","true")),s.body.appendChild(i))}function g(t,e){(e=e||p).forEach(function(e){e.postMessage(t,o)})}function f(t){0<d.filter(function(e){return JSON.stringify(e)===JSON.stringify(t)}).length||(d.push(t),g(t))}function h(e,t,r){var i,n,s=window.localStorage.getItem("tt_bw_id"),a=e.payload,c={currency:a.currency||r.currency,reference:a.reference||r.reservationId,price:a.price||r.totalPrice,checkin:a.checkin,checkout:a.checkout,basePrice:a.basePrice,tripteaseUserId:t.tripteaseUserId,sessionId:e.sessionId};i=t.apiKey,n=c,r=window.localStorage.getItem("tt_bw_id"),a=n.checkin,e=n.checkout,u("img","tt-rt-conv-pixel",o+"/tracking?event=converted&apiKey="+i+"&currency="+n.currency+"&reservationId="+n.reference+"&totalPrice="+n.price+"&checkin="+(a?a.toISOString().split("T")[0]:"")+"&checkout="+(e?e.toISOString().split("T")[0]:"")+"&basePrice="+(n.basePrice||"")+"&platformUserId="+r+"&tripteaseUserId="+n.tripteaseUserId+"&sessionId="+n.sessionId),f({type:"triptease.retargeting.conversion",apiKey:t.apiKey,platformUserId:s,currency:c.currency,reservationId:c.reference,totalPrice:c.price,checkin:c.checkin,checkout:c.checkout,basePrice:c.basePrice,tripteaseUserId:c.tripteaseUserId,sessionId:c.sessionId})}window.addEventListener("message",function(e){var t,r,i,n;e.data&&"triptease.config"===e.data.type&&e.data.userId&&(i=(t=e.data).payload,r=window.triptease&&window.triptease.config&&window.triptease.config.reservation,i={tripteaseUserId:t.userId,sessionId:t.sessionId,apiKey:i.apiKey,bucket:function(e){var t,r=0;if(0===e.length)return r.toString();for(t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return(Math.abs(r)%2).toString()}(t.userId),conversion:"Confirmation"===i.type&&"confirmed"===i.reservationStatus||!!r,searched:"RoomsAndRates"===i.type},JSON.stringify(i)!==JSON.stringify(c)&&(function(e){var t="tt-bee-tracking-tags",r=o+"?apikey="+e.apiKey+"&bucket="+e.bucket+"&conversion="+e.conversion+"&clicked="+a+"&searched="+e.searched+"&tripteaseUserId="+e.tripteaseUserId;if(e=s.getElementById(t)){if(e.src===r)return;e.parentNode.removeChild(e)}u("iframe",t,r)}(c=i),i.conversion&&h(t,i,r))),!e.data||"triptease.retargeting.ready"!==e.data.type||(n=e.source||e.data.listener)&&(p.push(n),d.forEach(function(e){g(e,[n])}))}),f({type:"triptease.retargeting.page-view"})}ttRetargeting();